
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>[Unexecuted] Parameter estimation tutorial &#8212; NZ-GW workshop</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Notebook time/memory profile" href="notebook_profile.html" />
    <link rel="prev" title="Parameter estimation tutorial" href="workshop_notebook.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">NZ-GW workshop</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="workshop_notebook.html">
                    Parameter estimation tutorial
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   [Unexecuted] Parameter estimation tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="notebook_profile.html">
   Notebook time/memory profile
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://colab.research.google.com/github/avivajpeyi/nz_gravity_workshop/blob/main/src/unexecuted.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/unexecuted.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   [Unexecuted] Parameter estimation tutorial
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bayesian-inference-intro">
   Bayesian Inference intro
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#signal-model">
     Signal Model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#priors">
     Priors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#likelihood">
     Likelihood
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#brute-force-posterior-computation">
     Brute force posterior computation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampling-from-the-posterior">
     Sampling from the posterior
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cbc-gw-signal-model">
   CBC GW  Signal Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cbc-parameter-estimation">
   CBC Parameter Estimation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulate-a-signal">
     Simulate a signal
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inject-the-signal-into-an-interferometer-s-data-stream">
     Inject the signal into an interferometer’s data stream
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#notes-about-noise">
       Notes about noise:
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#power-ampitude-spectral-density-generation-psd-asd">
         Power/Ampitude-spectral-density generation (PSD/ASD)
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#glitches">
         Glitches
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#lines">
         Lines
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-priors-for-analysis">
     Create priors for analysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-likelihood-to-use-for-analysis">
     Create the likelihood to use for analysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-inference">
     Run inference
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#make-some-plots">
     Make some plots
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cleanup">
     Cleanup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis-of-gw150914">
   Analysis of GW150914
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#downloading-ifo-data">
     Downloading IFO data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getting-priors">
     Getting priors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inference-step">
     Inference step
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#accessing-gwtc-parameter-estimation-results">
   Accessing GWTC parameter estimation results
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>[Unexecuted] Parameter estimation tutorial</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   [Unexecuted] Parameter estimation tutorial
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bayesian-inference-intro">
   Bayesian Inference intro
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#signal-model">
     Signal Model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#priors">
     Priors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#likelihood">
     Likelihood
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#brute-force-posterior-computation">
     Brute force posterior computation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampling-from-the-posterior">
     Sampling from the posterior
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cbc-gw-signal-model">
   CBC GW  Signal Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cbc-parameter-estimation">
   CBC Parameter Estimation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulate-a-signal">
     Simulate a signal
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inject-the-signal-into-an-interferometer-s-data-stream">
     Inject the signal into an interferometer’s data stream
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#notes-about-noise">
       Notes about noise:
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#power-ampitude-spectral-density-generation-psd-asd">
         Power/Ampitude-spectral-density generation (PSD/ASD)
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#glitches">
         Glitches
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#lines">
         Lines
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-priors-for-analysis">
     Create priors for analysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-likelihood-to-use-for-analysis">
     Create the likelihood to use for analysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-inference">
     Run inference
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#make-some-plots">
     Make some plots
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cleanup">
     Cleanup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis-of-gw150914">
   Analysis of GW150914
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#downloading-ifo-data">
     Downloading IFO data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getting-priors">
     Getting priors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inference-step">
     Inference step
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#accessing-gwtc-parameter-estimation-results">
   Accessing GWTC parameter estimation results
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="unexecuted-parameter-estimation-tutorial">
<h1>[Unexecuted] Parameter estimation tutorial<a class="headerlink" href="#unexecuted-parameter-estimation-tutorial" title="Permalink to this headline">#</a></h1>
<p>There are a quite a few steps to analyse GW data. Today we’ll focus on the middle panel:
<img alt="Screen-Shot-2022-11-21-at-10-35-12-pm-1.png" src="https://i.postimg.cc/dtLCYm7Y/Screen-Shot-2022-11-21-at-10-35-12-pm-1.png" /></p>
<p>Note: this notebook has been created by adapting materials from:</p>
<ol class="simple">
<li><p><a class="reference external" href="https://github.com/ColmTalbot/intoduction_to_inference">Colm Talbots’ inference series</a></p></li>
<li><p><a class="reference external" href="https://git.ligo.org/lscsoft/bilby/-/blob/master/examples/gw_examples/injection_examples/fast_tutorial.py">Bilby’s fast GW injection example</a></p></li>
<li><p><a class="reference external" href="https://git.ligo.org/lscsoft/bilby/-/blob/master/examples/gw_examples/data_examples/GW150914.py">Bilby’s GW150914 example</a></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>bilby<span class="o">[</span>gw<span class="o">]==</span><span class="m">1</span>.4.1<span class="w"> </span>-q
<span class="c1"># NOTE: you&#39;ll have to restart your runtime after this</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">bilby</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">corner.core</span> <span class="kn">import</span> <span class="n">quantile</span>
<span class="kn">from</span> <span class="nn">corner</span> <span class="kn">import</span> <span class="n">corner</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">INJECTION_URL</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.zenodo.org/record/1163982/files/injection_result.json?download=1&quot;</span>
<span class="n">GW150914_URL</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.zenodo.org/record/1164558/files/GW150914_result.json?download=1&quot;</span>
<span class="n">GW200308_URL</span> <span class="o">=</span> <span class="s2">&quot;https://zenodo.org/record/5546663/files/IGWN-GWTC3p0-v1-GW200308_173609_PEDataRelease_mixed_cosmo.h5?download=1&quot;</span>



<span class="k">def</span> <span class="nf">notebook_setup</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;bilby&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;savefig.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sans-serif&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.sans-serif&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Liberation Sans&quot;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.cursive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Liberation Sans&quot;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;mathtext.fontset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;custom&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">,</span> <span class="n">tqdm</span><span class="p">(</span>
        <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Downloading </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;iB&#39;</span><span class="p">,</span>
        <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">unit_divisor</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">bar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">):</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            


<span class="n">notebook_setup</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RE_RUN_SLOW_CELLS</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">OUTDIR</span> <span class="o">=</span> <span class="s2">&quot;outdir&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="bayesian-inference-intro">
<h1>Bayesian Inference intro<a class="headerlink" href="#bayesian-inference-intro" title="Permalink to this headline">#</a></h1>
<p>To start, lets take a look at Bayes’ theorem:</p>
<div class="amsmath math notranslate nohighlight" id="equation-86ceb4da-5400-4d94-b9bb-102566843036">
<span class="eqno">(8)<a class="headerlink" href="#equation-86ceb4da-5400-4d94-b9bb-102566843036" title="Permalink to this equation">#</a></span>\[\begin{align}
\rm{Posterior} &amp;= \frac{\rm{Prior} * \rm{Likelihood}}{\rm{Evidence}}  \\
\implies P(\theta|\rm{data}) &amp;= \frac{\pi(\theta)\  \mathcal{L}(\rm{data}|\theta)}{\int_{\theta} \pi(\theta)\ \mathcal{L}(\rm{data}|\theta)\ d\theta}\\
 &amp;= \frac{\pi(\theta)\  \mathcal{L}(\rm{data}|\theta)}{\mathcal{Z}(data)}
\end{align}\]</div>
<p>For a primer on Bayesian inference in GW, please look at <a class="reference external" href="https://arxiv.org/abs/1809.02293">Eric Thrane + Colm Talbot’s paper</a>.</p>
<p>In this workshop we will focus more on how we can perform inference and not focus too much on the maths.</p>
<p>Lets look at an example of how we can use Bayesian inference to analyse the following data:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">observation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="o">-</span><span class="mf">1.65</span><span class="p">,</span> <span class="mf">1.93</span><span class="p">,</span> <span class="mf">2.88</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.28</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.02</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">1.49</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.95</span><span class="p">,</span> 
    <span class="mf">3.64</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.47</span><span class="p">,</span> <span class="mf">3.91</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.16</span><span class="p">,</span> <span class="mf">1.03</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">6.96</span><span class="p">,</span> <span class="mf">1.07</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.69</span><span class="p">,</span> 
    <span class="o">-</span><span class="mf">7.18</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.94</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.37</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.09</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.07</span><span class="p">,</span> <span class="mf">6.28</span><span class="p">,</span> <span class="mf">1.73</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">4.11</span><span class="p">,</span>
    <span class="mf">1.29</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.21</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.06</span><span class="p">,</span> <span class="mf">3.67</span><span class="p">,</span> <span class="mf">0.91</span><span class="p">,</span> <span class="mf">0.64</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.51</span><span class="p">,</span> 
    <span class="mf">1.89</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.49</span><span class="p">,</span> <span class="mf">5.43</span><span class="p">,</span> <span class="mf">2.36</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">6.85</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">3.55</span><span class="p">,</span> 
    <span class="mf">3.43</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.98</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.06</span><span class="p">,</span> <span class="mf">6.79</span><span class="p">,</span> <span class="mf">3.27</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.62</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.16</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.19</span><span class="p">,</span>
    <span class="mf">1.75</span><span class="p">,</span> <span class="mf">6.18</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.72</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">4.85</span><span class="p">,</span> <span class="mf">6.83</span><span class="p">,</span> <span class="mf">10.35</span><span class="p">,</span> <span class="mf">3.83</span><span class="p">,</span> 
    <span class="mf">5.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.91</span><span class="p">,</span> <span class="mf">3.36</span><span class="p">,</span> <span class="mf">2.01</span><span class="p">,</span> <span class="mf">4.37</span><span class="p">,</span> <span class="mf">4.03</span><span class="p">,</span> <span class="mf">6.05</span><span class="p">,</span> <span class="mf">2.62</span><span class="p">,</span> 
    <span class="mf">5.16</span><span class="p">,</span> <span class="mf">3.57</span><span class="p">,</span> <span class="mf">3.74</span><span class="p">,</span> <span class="mf">7.07</span><span class="p">,</span> <span class="mf">3.89</span><span class="p">,</span> <span class="mf">9.91</span><span class="p">,</span> <span class="mf">3.89</span><span class="p">,</span> <span class="mf">3.41</span><span class="p">,</span> <span class="mf">7.71</span><span class="p">,</span> <span class="mf">2.79</span><span class="p">,</span>
    <span class="mf">3.98</span><span class="p">,</span> <span class="mf">4.91</span><span class="p">,</span> <span class="mf">1.87</span><span class="p">,</span> <span class="mf">2.65</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.42</span><span class="p">,</span> <span class="mf">11.26</span><span class="p">,</span> <span class="mf">5.06</span><span class="p">,</span> <span class="mf">8.83</span><span class="p">,</span> <span class="mf">2.87</span><span class="p">,</span> 
    <span class="mf">8.66</span><span class="p">,</span> <span class="mf">3.95</span><span class="p">,</span> <span class="mf">6.05</span><span class="p">,</span> <span class="mf">8.2</span><span class="p">,</span> <span class="mf">3.07</span><span class="p">,</span> <span class="mf">2.88</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">,</span> <span class="mf">3.84</span>
<span class="p">])</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span>
    <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> 
    <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.9</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> 
    <span class="mf">3.6</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">4.3</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">,</span> <span class="mf">4.7</span><span class="p">,</span> 
    <span class="mf">4.8</span><span class="p">,</span> <span class="mf">4.9</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">,</span> <span class="mf">5.3</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">,</span> <span class="mf">5.9</span><span class="p">,</span> 
    <span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.1</span><span class="p">,</span> <span class="mf">6.2</span><span class="p">,</span> <span class="mf">6.3</span><span class="p">,</span> <span class="mf">6.4</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">,</span> <span class="mf">6.7</span><span class="p">,</span> <span class="mf">6.8</span><span class="p">,</span> <span class="mf">6.9</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.1</span><span class="p">,</span> 
    <span class="mf">7.2</span><span class="p">,</span> <span class="mf">7.3</span><span class="p">,</span> <span class="mf">7.4</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mf">7.6</span><span class="p">,</span> <span class="mf">7.7</span><span class="p">,</span> <span class="mf">7.8</span><span class="p">,</span> <span class="mf">7.9</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">8.1</span><span class="p">,</span> <span class="mf">8.2</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">,</span> 
    <span class="mf">8.4</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mf">8.6</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">,</span> <span class="mf">8.8</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">9.1</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">,</span> <span class="mf">9.4</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">,</span> 
    <span class="mf">9.6</span><span class="p">,</span> <span class="mf">9.7</span><span class="p">,</span> <span class="mf">9.8</span><span class="p">,</span> <span class="mf">9.9</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>

<span class="n">plot_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Lets assume:</p>
<ol class="simple">
<li><p>The observed data <code class="docutils literal notranslate"><span class="pre">d(t)</span></code> consists of the following: <code class="docutils literal notranslate"><span class="pre">d(t)</span> <span class="pre">=</span> <span class="pre">n(t)</span> <span class="pre">+</span> <span class="pre">s(t)</span></code>.</p></li>
<li><p>The noise <code class="docutils literal notranslate"><span class="pre">n(t)</span></code> is <code class="docutils literal notranslate"><span class="pre">Gaussian</span> <span class="pre">white</span> <span class="pre">noise</span></code> (drawn from a Normal distribution).</p></li>
<li><p>The signal <code class="docutils literal notranslate"><span class="pre">s(t)</span></code> is a straight-line signal.</p></li>
</ol>
<p>With these assumptions, we can start implementing our Bayesian inference pipeline.</p>
<section id="signal-model">
<h2>Signal Model<a class="headerlink" href="#signal-model" title="Permalink to this headline">#</a></h2>
<p>Assuming a straight line signal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">signal_model</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">time</span> <span class="o">*</span> <span class="n">m</span> <span class="o">+</span> <span class="n">c</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="priors">
<h2>Priors<a class="headerlink" href="#priors" title="Permalink to this headline">#</a></h2>
<p>Now we can write down some priors on the parameters <code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code> of this model.
This is what we think our parameters can potentially be.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bilby</span>

<span class="n">priors</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">PriorDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">m</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">TruncatedNormal</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">),</span>
    <span class="n">c</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">),</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>To test our prior, lets draw some prior samples and print some samples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">priors</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Lets plot some histograms of these samples in a <code class="docutils literal notranslate"><span class="pre">corner</span></code> plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">corner</span> <span class="kn">import</span> <span class="n">corner</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">priors</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)),</span>
    <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
    <span class="n">plot_contours</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:gray&quot;</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">priors</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Prior Samples&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Here each column/row represents one parameter.</p>
<p>The plots along the upper diagonal show the 1D histograms of the parameters.
In the above, these represent <code class="docutils literal notranslate"><span class="pre">pi(m)</span></code> and <code class="docutils literal notranslate"><span class="pre">pi(c)</span></code> – the prior distributions for <code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code>.</p>
<p>The plots on the inside of the corner show the 2D histograms for the intersecting parameters.
Here, the 2D join distribution is <code class="docutils literal notranslate"><span class="pre">pi(m,c)</span></code>.</p>
<p>At this point, lets test out our model and priors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_model_on_data</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">plot_each_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">):</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">],</span> <span class="n">samples</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
    
    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">signal_model</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">ci</span><span class="p">)</span> <span class="k">for</span> <span class="n">mi</span><span class="p">,</span> <span class="n">ci</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
    
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="n">y_low</span><span class="p">,</span> <span class="n">y_mean</span><span class="p">,</span> <span class="n">y_up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">y_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> mean&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">y_low</span><span class="p">,</span> <span class="n">y_up</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> 90%&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot_each_sample</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ys</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        
    <span class="n">plot_data</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>


    
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_model_on_data</span><span class="p">(</span><span class="n">priors</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;prior&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Looks like the model can potentially fit the data! Lets try to use the Bayesian inference framework to help us get estimates on the model parameters.</p>
</section>
<section id="likelihood">
<h2>Likelihood<a class="headerlink" href="#likelihood" title="Permalink to this headline">#</a></h2>
<p>Recall the assumption that <code class="docutils literal notranslate"><span class="pre">d(t)</span> <span class="pre">=</span> <span class="pre">n(t)</span> <span class="pre">+</span> <span class="pre">s(t)</span></code>, and that the noise is normally distributed. Using this, we can write:</p>
<div class="amsmath math notranslate nohighlight" id="equation-fca4fe82-2b97-47ef-aff9-617c4a82c537">
<span class="eqno">(9)<a class="headerlink" href="#equation-fca4fe82-2b97-47ef-aff9-617c4a82c537" title="Permalink to this equation">#</a></span>\[\begin{align}
n(t) &amp;= s(t) - d(t)\\
&amp;= \mathcal{N}(\sigma=3, \mu=0)
\end{align}\]</div>
<p>[NOTE: we’ve hardcoded <code class="docutils literal notranslate"><span class="pre">sigma</span></code> here, but you could add in a prior on <code class="docutils literal notranslate"><span class="pre">sigma</span></code> as well]</p>
<p>Hence, we can write out the signal-model likliood <code class="docutils literal notranslate"><span class="pre">L(data|m,c)</span></code> as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-acad7479-d1c4-48c1-a06e-4c01c12b3b2f">
<span class="eqno">(10)<a class="headerlink" href="#equation-acad7479-d1c4-48c1-a06e-4c01c12b3b2f" title="Permalink to this equation">#</a></span>\[\begin{align}
\mathcal{L}(\rm{data}|m,c) = \prod_j \rm{Normal}_{\rm{PDF}}(\left[d - s_j\right]; \mu=0,\sigma=3)
\end{align}\]</div>
<p>This type of <code class="docutils literal notranslate"><span class="pre">Gaussian</span></code> likelihoods has already been coded up in <code class="docutils literal notranslate"><span class="pre">bilby</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">GaussianLikelihood</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="n">signal_model</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s test if we can compute a likelihood and dont get a nan:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we need to provide the parameter to compute the likeliood for</span>
<span class="n">likelihood</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Log Likelihood (data| </span><span class="si">{</span><span class="n">likelihood</span><span class="o">.</span><span class="n">parameters</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">likelihood</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="brute-force-posterior-computation">
<h2>Brute force posterior computation<a class="headerlink" href="#brute-force-posterior-computation" title="Permalink to this headline">#</a></h2>
<p>We now have everything we need to compute our posterior!
In the first pass, lets compute the posterior over a grid of <code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code> values:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_grid_of_m_c</span><span class="p">(</span><span class="n">n_per_dim</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
    <span class="k">assert</span> <span class="s2">&quot;m&quot;</span> <span class="ow">in</span> <span class="n">prior</span> <span class="ow">and</span> <span class="s2">&quot;c&quot;</span> <span class="ow">in</span> <span class="n">prior</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
    <span class="n">m_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">m</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">m</span><span class="p">),</span> <span class="n">n_per_dim</span><span class="p">)</span>
    <span class="n">c_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">c</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">c</span><span class="p">),</span> <span class="n">n_per_dim</span><span class="p">)</span>
    <span class="n">m_grid</span><span class="p">,</span> <span class="n">c_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">m_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">c</span><span class="o">=</span><span class="n">c_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>


<span class="k">def</span> <span class="nf">plot_grid</span><span class="p">(</span><span class="n">m_c_grid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">m_c_grid</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">m_c_grid</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">12.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>
    

<span class="n">m_c_grid</span> <span class="o">=</span> <span class="n">get_grid_of_m_c</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">priors</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_grid</span><span class="p">(</span><span class="n">m_c_grid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Computing the prior, likelhood and posterior at each grid-point:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_brute_force_analysis</span><span class="p">(</span><span class="n">likelihood</span><span class="p">,</span> <span class="n">prior</span><span class="p">,</span> <span class="n">samples_list</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples_list</span><span class="p">)</span>
    <span class="n">log_likelihoods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">log_priors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">log_posteriors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> 
    <span class="n">log_evidence</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Brute force LnL computation&quot;</span><span class="p">):</span>
        <span class="n">likelihood</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">samples_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">log_likelihoods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">likelihood</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">()</span>
        <span class="n">log_priors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">ln_prob</span><span class="p">(</span><span class="n">samples_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">log_posteriors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_priors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">log_likelihoods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">log_evidence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logaddexp</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">log_posteriors</span><span class="o">+</span><span class="n">log_priors</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">samples</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">samples_list</span><span class="p">),</span>
        <span class="n">log_evidence</span><span class="o">=</span><span class="n">log_evidence</span><span class="p">,</span>
        <span class="n">likelihood</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_likelihoods</span><span class="p">),</span>
        <span class="n">prior</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_priors</span><span class="p">),</span>
        <span class="n">posterior</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_posteriors</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_grids_of_brute_result</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">xlims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_vals</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">7.5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">pi</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="n">like</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;prior&#39;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;posterior&#39;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;likelihood&#39;</span><span class="p">]</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">log_vals</span><span class="p">:</span>
        <span class="n">pi</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="n">like</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">post</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">like</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;log &quot;</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;$\pi(m,c)$&quot;</span><span class="p">)</span>
    <span class="n">plot_grid</span><span class="p">(</span><span class="n">m_c_grid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;$L(data|m,c)$&quot;</span><span class="p">)</span>
    <span class="n">plot_grid</span><span class="p">(</span><span class="n">m_c_grid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">like</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;$p(m,c|data)$&quot;</span><span class="p">)</span>
    <span class="n">plot_grid</span><span class="p">(</span><span class="n">m_c_grid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">post</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">xlims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="n">xlims</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
    
<span class="n">brute_result</span> <span class="o">=</span> <span class="n">run_brute_force_analysis</span><span class="p">(</span><span class="n">likelihood</span><span class="p">,</span> <span class="n">priors</span><span class="p">,</span> <span class="n">m_c_grid</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_grids_of_brute_result</span><span class="p">(</span><span class="n">brute_result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Brute force log evidence = </span><span class="si">{</span><span class="n">brute_result</span><span class="p">[</span><span class="s1">&#39;log_evidence&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Looks like the answer is around</p>
<div class="amsmath math notranslate nohighlight" id="equation-afac6f59-526e-4c82-9b53-91b95d43a401">
<span class="eqno">(11)<a class="headerlink" href="#equation-afac6f59-526e-4c82-9b53-91b95d43a401" title="Permalink to this equation">#</a></span>\[\begin{align}
0&lt;m&lt;1, 1 &lt; c &lt; -2
\end{align}\]</div>
<p>We can even compute the marginal posteriors:</p>
<div class="amsmath math notranslate nohighlight" id="equation-1c14311e-ef55-4a11-ba00-bc730bd5f0db">
<span class="eqno">(12)<a class="headerlink" href="#equation-1c14311e-ef55-4a11-ba00-bc730bd5f0db" title="Permalink to this equation">#</a></span>\[\begin{align}
p(m|d)&amp;= \int_c p(m,c|d)\ dc\\
p(c|d)&amp;= \int_m p(m,c|d)\ dm
\end{align}\]</div>
<p>These will give us the estimated values for the model parameters</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">corner.core</span> <span class="kn">import</span> <span class="n">quantile</span>

<span class="k">def</span> <span class="nf">get_marginalised_posterior</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;samples&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">unique_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">parameter</span><span class="p">])</span>
    <span class="n">log_post</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">))</span>
    <span class="n">grid</span><span class="p">[</span><span class="s1">&#39;log_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;posterior&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_values</span><span class="p">):</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">grid</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">log_post</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logaddexp</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s2">&quot;log_post&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">unique_values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_post</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">p_of_x</span> <span class="o">=</span> <span class="n">get_marginalised_posterior</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">brute_result</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p_of_x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:purple&quot;</span><span class="p">)</span>
    <span class="n">low</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">up</span> <span class="o">=</span> <span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="n">p_of_x</span><span class="p">)</span>
    <span class="n">low</span><span class="p">,</span> <span class="n">up</span> <span class="o">=</span> <span class="n">mean</span><span class="o">-</span><span class="n">low</span><span class="p">,</span> <span class="n">up</span><span class="o">-</span><span class="n">mean</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;${{</span><span class="si">{0:.2f}</span><span class="s2">}}_{{-</span><span class="si">{1:.2f}</span><span class="s2">}}^{{+</span><span class="si">{2:.2f}</span><span class="s2">}}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lets also plot the posterior predictive check:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_model_on_data</span><span class="p">(</span><span class="n">priors</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;prior&quot;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_model_on_data</span><span class="p">(</span>
    <span class="n">m_c_grid</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">brute_result</span><span class="p">[</span><span class="s1">&#39;posterior&#39;</span><span class="p">]),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:purple&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;posterior&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This time with just the posterior:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_model_on_data</span><span class="p">(</span>
    <span class="n">m_c_grid</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">brute_result</span><span class="p">[</span><span class="s1">&#39;posterior&#39;</span><span class="p">]),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:purple&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;posterior&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sampling-from-the-posterior">
<h2>Sampling from the posterior<a class="headerlink" href="#sampling-from-the-posterior" title="Permalink to this headline">#</a></h2>
<p>There are some drawbacks from brute-force posterior estimation.</p>
<p>What happens when the number of parameters increases to 15?</p>
<p>Drawing samples from the posterior and trying to estimate the likelihood may be a cheaper approach.</p>
<p>Below is some code to demonstrate how we can use bilby + a <code class="docutils literal notranslate"><span class="pre">nested</span></code> sampler “dynesty” to do this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sampler_run</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">run_sampler</span><span class="p">(</span>
        <span class="n">likelihood</span><span class="o">=</span><span class="n">likelihood</span><span class="p">,</span>
        <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span>
        <span class="n">sampler</span><span class="o">=</span><span class="s2">&quot;dynesty&quot;</span><span class="p">,</span>
        <span class="n">nlive</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">sample</span><span class="o">=</span><span class="s2">&quot;unif&quot;</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;linear_regression&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">sampler_result</span> <span class="o">=</span> <span class="n">sampler_run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can make some plots.</p>
<p>First, lets plot the <code class="docutils literal notranslate"><span class="pre">corner</span></code> plot, and overplot the prior (in green) in the 1D distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">sampler_result</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span><span class="n">priors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now lets check how well we have done (comparing against the true value):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">truths</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_model_on_data</span><span class="p">(</span><span class="n">sampler_result</span><span class="o">.</span><span class="n">posterior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">signal_model</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">truths</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">truths</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:orange&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p>Lets finally compare the brute-force results and the nested-sampling results:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">overplot_sampler_and_brute_force</span><span class="p">(</span><span class="n">sampler_result</span><span class="p">,</span> <span class="n">brute_result</span><span class="p">,</span> <span class="n">truths</span><span class="p">):</span>
    <span class="n">truths</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">truths</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">truths</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">])</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">sampler_result</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">truths</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># overplot the grid estimates</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span>
    
    <span class="c1"># add marginals </span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">axi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">axi</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">p_of_x</span> <span class="o">=</span> <span class="n">get_marginalised_posterior</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">brute_result</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p_of_x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:purple&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.15</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p_of_x</span><span class="p">))</span>
        
    
    <span class="n">samples_grid</span> <span class="o">=</span> <span class="n">brute_result</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span>
    <span class="n">n_cells</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples_grid</span><span class="p">)))</span>
    <span class="n">m_grid</span> <span class="o">=</span> <span class="n">samples_grid</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">)</span>
    <span class="n">c_grid</span> <span class="o">=</span> <span class="n">samples_grid</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">)</span>
    <span class="n">posterior_grid</span> <span class="o">=</span> <span class="n">brute_result</span><span class="p">[</span><span class="s1">&#39;posterior&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
        <span class="n">m_grid</span><span class="p">,</span> <span class="n">c_grid</span><span class="p">,</span> <span class="n">posterior_grid</span><span class="p">,</span> 
        <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">posterior_grid</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Purples&quot;</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sampler&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Brute-Force&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:purple&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:orange&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Brute force ln_evidence: </span><span class="si">{</span><span class="n">brute_result</span><span class="p">[</span><span class="s1">&#39;log_evidence&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sampler ln_evidence: </span><span class="si">{</span><span class="n">sampler_result</span><span class="o">.</span><span class="n">log_evidence</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">overplot_sampler_and_brute_force</span><span class="p">(</span><span class="n">sampler_result</span><span class="p">,</span> <span class="n">brute_result</span><span class="p">,</span> <span class="n">truths</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Both sets of results match up quite well! Even the log-evidences are comparable.</p>
<p>Lets move on to GW signals!</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="cbc-gw-signal-model">
<h1>CBC GW  Signal Model<a class="headerlink" href="#cbc-gw-signal-model" title="Permalink to this headline">#</a></h1>
<p>The GW from compact binary coalescence (CBC) systems can be modeled using the following parameters:</p>
<ul class="simple">
<li><p>2 mass parameters (eg m1, m2)</p></li>
<li><p>6 spin parameters (eg s1x, s1y, s1z, …)</p></li>
<li><p>2 tidal deformation parameters (for neutron stars, lambda1, lambda2)</p></li>
<li><p>2 orbital eccentricity parameters (e, arg of periastron)</p></li>
<li><p>7 extrinsic parameters (distance, sky-loc, timing, phase)</p></li>
</ul>
<p>Some of these are shown here:</p>
<div>
<img src="https://gcdnb.pbrd.co/images/EfwMgftuS4L5.png?o=1" width="350"/>
</div>
<p>Additionally, there are quite a few re-parameterisations of these.</p>
<p>For example, instead of the component masses $m_1, m_2$, one could also use the</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mass_ratio</span></code>: <code class="docutils literal notranslate"><span class="pre">q=m_2/m_1</span></code> where <code class="docutils literal notranslate"><span class="pre">m_1&gt;m_2</span></code>, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chirp_mass</span></code>:</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-b133756f-788d-41a9-9409-b393751d81b1">
<span class="eqno">(13)<a class="headerlink" href="#equation-b133756f-788d-41a9-9409-b393751d81b1" title="Permalink to this equation">#</a></span>\[\begin{align}
\mathcal{M} = \frac{(m_1 m_2)^{3/5}}{(m_1 + m_2)^{1/5}}
\end{align}\]</div>
<p>Similarly, we can use parameterize the dimensionless spins with the following 6 parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">chi_i</span></code> or $a_i$ : the spin magnitude (<code class="docutils literal notranslate"><span class="pre">0&lt;a_i&lt;1</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">theta_i</span></code> or <code class="docutils literal notranslate"><span class="pre">tilt_i</span></code>: the angle of the component binary wrt the <code class="docutils literal notranslate"><span class="pre">z</span></code> axis (along the orbital axis)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">phi_12</span></code>: the difference between the component spins projected on the <code class="docutils literal notranslate"><span class="pre">xy</span></code> plane (along the orbital plane)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">theta_jl</span></code>: the angle between the orbital angular momentum <code class="docutils literal notranslate"><span class="pre">L</span></code> vector and the total angular momentum vector <code class="docutils literal notranslate"><span class="pre">J</span></code>.</p></li>
</ul>
<p>Lets go over all the parameters in more detail:</p>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">Intrinsic parameters</label><div class="tab-content docutils">
<p><strong>INTRINSIC PARAMETERS</strong></p>
<ul class="simple">
<li><p>Mass: 2D</p>
<ul>
<li><p>Usually uniform in two mass parameters</p></li>
<li><p>Component masses widely used (<code class="docutils literal notranslate"><span class="pre">m_1,</span> <span class="pre">m_2</span></code>)</p></li>
<li><p>“Chirp” mass and mass ratio a more convenient basis</p></li>
<li><p>Usually specified in the “detector-frame”, redshifted relative to true “source-frame” mass</p></li>
</ul>
</li>
<li><p>Dimensionless Spin: 6D</p>
<ul>
<li><p>Fully precessing (see animation)</p>
<ul>
<li><p>usually uniform in magnitude and isotropic in orientation</p></li>
</ul>
</li>
<li><p>Only spin aligned with orbital angular momentum - set planar spin components to zero</p>
<ul>
<li><p>same prior on aligned spin as in the precessing case</p></li>
<li><p>uniform in aligned spin</p></li>
</ul>
</li>
<li><p>Zero spin</p>
<ul>
<li><p>all spin components are zero</p></li>
<li><p>smaller space to sample</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Orbital eccentricity: 1D/2D</p>
<ul>
<li><p>Often ignored (eccentricity and argument of periastron)</p></li>
</ul>
</li>
<li><p>Matter effects (for neutron stars): 2D</p>
<ul>
<li><p>Two tidal deformability parameters <code class="docutils literal notranslate"><span class="pre">Lambda_i</span></code></p></li>
<li><p>Parameters describing the neutron star equation of state (EoS)</p>
<ul>
<li><p>Variable number</p></li>
<li><p>Zero-dimensional for fixed equation of state</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">Extrinsic parameters </label><div class="tab-content docutils">
<p><strong>EXTRINSIC PARAMETERS</strong></p>
<ul class="simple">
<li><p>Location: 3D</p>
<ul>
<li><p>ra, dec, distance</p></li>
<li><p>Usually isotropic over the sky</p></li>
<li><p>Distance prior uniform in volume</p>
<ul>
<li><p>Should include cosmological effects</p></li>
</ul>
</li>
<li><p>Use host galaxy location, e.g., GW170817, S190521g(?)</p></li>
</ul>
</li>
<li><p>Orientation: 4D</p>
<ul>
<li><p>Three Euler angles (phase, inclination, polarisation)</p>
<ul>
<li><p>Assumed to be distributed isotropically</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Merger time</p>
<ul>
<li><p>Uniform based on expected uncertainty in trigger time</p></li>
<li><p>Typically ~ 0.1s</p></li>
</ul>
</li>
</ul>
</div>
</div>
<p>Note: increasing the spin in the x-y components can lead to precession.</p>
<div>
<img src="https://media4.giphy.com/media/NF76iRgEerkx0qrsD0/giphy.gif?cid=790b76113d85f36207d50f4d1f42feead29a3c4cb8f2f1a6&rid=giphy.gif&ct=g" width="350"/>
</div>
<p>Such a highly precessing system may be found in globular clusters/AGNs.</p>
<p>Lets plot our own waveform:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bilby</span>
<span class="kn">from</span> <span class="nn">bilby.gw.conversion</span> <span class="kn">import</span> <span class="n">chirp_mass_and_mass_ratio_to_component_masses</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">bilby_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;bilby&quot;</span><span class="p">)</span>
<span class="n">bilby_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">make_waveform_generator</span><span class="p">(</span><span class="n">approximant</span><span class="o">=</span><span class="s2">&quot;IMRPhenomPv2&quot;</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
                            <span class="n">frequency_domain_source_model</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">lal_binary_black_hole</span><span class="p">,</span> <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a waveform generator&quot;&quot;&quot;</span>
    <span class="n">generator_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
        <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">sampling_frequency</span><span class="p">,</span>
        <span class="n">frequency_domain_source_model</span><span class="o">=</span><span class="n">frequency_domain_source_model</span><span class="p">,</span>
        <span class="n">waveform_arguments</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">waveform_approximant</span><span class="o">=</span><span class="n">approximant</span><span class="p">,</span>
            <span class="n">reference_frequency</span><span class="o">=</span><span class="mf">20.</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">WaveformGenerator</span><span class="p">(</span><span class="o">**</span><span class="n">generator_args</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">compute_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="n">signal_parameters</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the waveform&quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="c1"># two mass parameters</span>
        <span class="n">mass_1</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">mass_2</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="c1"># 6 spin parameters</span>
        <span class="n">a_1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">a_2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">tilt_1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tilt_2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">phi_jl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">phi_12</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="c1"># 2 tidal deformation parameters (for NS)</span>
        <span class="n">lambda_1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lambda_2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="c1"># 7 extrinsic parameters (skyloc, timing, phase, etc)</span>
        <span class="n">luminosity_distance</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">theta_jn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ra</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">psi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">geocent_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">signal_parameters</span><span class="p">)</span>
    <span class="n">bilby_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;computing waveform with parameters: </span><span class="si">{</span><span class="n">parameters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">time_domain_strain</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">time_array</span>
    <span class="n">approximant</span> <span class="o">=</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">waveform_arguments</span><span class="p">[</span><span class="s2">&quot;waveform_approximant&quot;</span><span class="p">]</span>
    <span class="n">delta_t</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">sampling_frequency</span>

    <span class="k">if</span> <span class="s2">&quot;IMR&quot;</span> <span class="ow">in</span> <span class="n">approximant</span><span class="p">:</span>
        <span class="c1"># IMR templates the zero of time is at max amplitude (merger)</span>
        <span class="c1"># thus we roll the waveform back a bit</span>
        <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">h</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">pol</span><span class="p">],</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">pol</span><span class="p">])</span> <span class="o">//</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">h_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;plus&#39;</span><span class="p">]))</span>
    <span class="n">h_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">h_phase</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">delta_t</span><span class="p">)</span>
    <span class="c1"># nan the freqs after the merger</span>
    <span class="n">h_freq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">h_freq</span><span class="p">):]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">h_freq</span><span class="p">,</span> <span class="n">t</span>


<span class="k">def</span> <span class="nf">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="n">signal_parameters</span><span class="o">=</span><span class="p">{},</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">polarisation</span><span class="o">=</span><span class="s1">&#39;plus&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">):</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">h_freq</span><span class="p">,</span> <span class="n">h_time</span> <span class="o">=</span> <span class="n">compute_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="n">signal_parameters</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">polarisation</span> <span class="o">==</span><span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h_time</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;plus&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;plus&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h_time</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h_time</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="n">polarisation</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Strain&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">h_time</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">h_time</span><span class="p">))</span>
    <span class="c1"># remove whitespace between subplots</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waveform_generator</span> <span class="o">=</span> <span class="n">make_waveform_generator</span><span class="p">(</span><span class="n">approximant</span><span class="o">=</span><span class="s2">&quot;IMRPhenomPv2&quot;</span><span class="p">)</span>
<span class="n">bilby_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mass_1</span><span class="o">=</span><span class="mf">20.</span><span class="p">,</span> <span class="n">mass_2</span><span class="o">=</span><span class="mf">25.</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">polarisation</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Q: What happens if we increase chirp-mass?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bilby_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span> <span class="c1"># turn off logging</span>
<span class="k">for</span> <span class="n">mc</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
    <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">chirp_mass_and_mass_ratio_to_component_masses</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">signal_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mass_1</span><span class="o">=</span><span class="n">m1</span><span class="p">,</span> <span class="n">mass_2</span><span class="o">=</span><span class="n">m2</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="n">signal_parameters</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2"> = &quot;</span><span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;M_{\odot}$&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> 
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Playing around with some interactive plots can also help build some intuition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>

<span class="c1"># @interact(a_1=(0.01, 1.0, 0.1)) # uncomment to enable interactive plot</span>
<span class="k">def</span> <span class="nf">interact_a1</span><span class="p">(</span><span class="n">a_1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a_1</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">a_2</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;a_1=0.01&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a_1</span><span class="o">=</span><span class="n">a_1</span><span class="p">,</span> <span class="n">a_2</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;a_1=</span><span class="si">{</span><span class="n">a_1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> 
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@interact(dist=(1000, 10000, 500)) # uncomment to enable interactive plot</span>
<span class="k">def</span> <span class="nf">interact_dist</span><span class="p">(</span><span class="n">dist</span><span class="o">=</span><span class="mi">2000</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">luminosity_distance</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;d=1000 Mpc&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">luminosity_distance</span><span class="o">=</span><span class="n">dist</span><span class="p">),</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;d=</span><span class="si">{</span><span class="n">dist</span><span class="si">}</span><span class="s2"> Mpc&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">7e-22</span><span class="p">,</span><span class="mf">7e-22</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="cbc-parameter-estimation">
<h1>CBC Parameter Estimation<a class="headerlink" href="#cbc-parameter-estimation" title="Permalink to this headline">#</a></h1>
<p>Finally, we get to actual parameter estimation for gravitational waves!</p>
<section id="simulate-a-signal">
<h2>Simulate a signal<a class="headerlink" href="#simulate-a-signal" title="Permalink to this headline">#</a></h2>
<p>We start by first simulating a signal (using the same code as the previous section for waveform generation)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bilby</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">bilby_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;bilby&quot;</span><span class="p">)</span>
<span class="n">bilby_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1"># Simulate signal</span>
<span class="n">duration</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="p">,</span> <span class="n">min_freq</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">1024.</span><span class="p">,</span> <span class="mi">20</span>
<span class="n">injection_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">mass_1</span><span class="o">=</span><span class="mf">36.0</span><span class="p">,</span> <span class="n">mass_2</span><span class="o">=</span><span class="mf">29.0</span><span class="p">,</span>  <span class="c1"># 2 mass parameters</span>
    <span class="n">a_1</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">a_2</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">tilt_1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">tilt_2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_12</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_jl</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># 6 spin parameters</span>
    <span class="n">ra</span><span class="o">=</span><span class="mf">1.375</span><span class="p">,</span> <span class="n">dec</span><span class="o">=-</span><span class="mf">1.2108</span><span class="p">,</span> <span class="n">luminosity_distance</span><span class="o">=</span><span class="mf">2000.0</span><span class="p">,</span> <span class="n">theta_jn</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># 7 extrinsic parameters</span>
    <span class="n">psi</span><span class="o">=</span><span class="mf">2.659</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span>
    <span class="n">geocent_time</span><span class="o">=</span><span class="mf">1126259642.413</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">inj_m1</span><span class="p">,</span> <span class="n">inj_m2</span> <span class="o">=</span> <span class="n">injection_parameters</span><span class="p">[</span><span class="s1">&#39;mass_1&#39;</span><span class="p">],</span> <span class="n">injection_parameters</span><span class="p">[</span><span class="s1">&#39;mass_2&#39;</span><span class="p">]</span>
<span class="n">inj_chirp_mass</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">component_masses_to_chirp_mass</span><span class="p">(</span><span class="n">inj_m1</span><span class="p">,</span> <span class="n">inj_m2</span><span class="p">)</span>
<span class="n">inj_q</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">component_masses_to_mass_ratio</span><span class="p">(</span><span class="n">inj_m1</span><span class="p">,</span> <span class="n">inj_m2</span><span class="p">)</span>

<span class="n">waveform_generator</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">WaveformGenerator</span><span class="p">(</span>
    <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
    <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">sampling_freq</span><span class="p">,</span>
    <span class="n">frequency_domain_source_model</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">lal_binary_black_hole</span><span class="p">,</span>
    <span class="n">parameter_conversion</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">convert_to_lal_binary_black_hole_parameters</span><span class="p">,</span>
    <span class="n">waveform_arguments</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">waveform_approximant</span><span class="o">=</span><span class="s2">&quot;IMRPhenomD&quot;</span><span class="p">,</span>
        <span class="n">reference_frequency</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
        <span class="n">minimum_frequency</span><span class="o">=</span><span class="n">min_freq</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is the signal we will inject into the detector noise&quot;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="n">injection_parameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="inject-the-signal-into-an-interferometer-s-data-stream">
<h2>Inject the signal into an interferometer’s data stream<a class="headerlink" href="#inject-the-signal-into-an-interferometer-s-data-stream" title="Permalink to this headline">#</a></h2>
<p>We can now simulate some detector noise and inject this signal into the detector-noise</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inject the signal into 1 detectors LIGO-Hanford (H1) at design sensitivity</span>
<span class="n">ifos</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">InterferometerList</span><span class="p">([</span><span class="s2">&quot;H1&quot;</span><span class="p">])</span>
<span class="n">ifos</span><span class="o">.</span><span class="n">set_strain_data_from_power_spectral_densities</span><span class="p">(</span>
    <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">sampling_freq</span><span class="p">,</span>
    <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
    <span class="n">start_time</span><span class="o">=</span><span class="n">injection_parameters</span><span class="p">[</span><span class="s2">&quot;geocent_time&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ifos</span><span class="o">.</span><span class="n">inject_signal</span><span class="p">(</span>
    <span class="n">waveform_generator</span><span class="o">=</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">injection_parameters</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">interferometer</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">:</span>
    <span class="n">analysis_data</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">frequency_domain_strain</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">frequency_array</span><span class="p">,</span> <span class="n">analysis_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:orange&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">frequency_array</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">amplitude_spectral_density_array</span><span class="p">),</span>
               <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ASD (estimated noise)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:orange&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">minimum_frequency</span><span class="p">,</span> <span class="n">interferometer</span><span class="o">.</span><span class="n">maximum_frequency</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency [Hz]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Strain [strain/$\sqrt{\rm Hz}$]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="notes-about-noise">
<h3>Notes about noise:<a class="headerlink" href="#notes-about-noise" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Lots of short duration glitches</p></li>
<li><p>The main contribution to LIGO/Virgo/KAGRA data is coloured Gaussian noise.</p></li>
<li><p>Constant frequency “lines”</p></li>
</ul>
<p>The Gaussian noise is described by the noise amplitude (power) spectral density, ASD (PSD).</p>
<p>Most conveniently described in the frequency domain using a <a class="reference external" href="https://en.wikipedia.org/wiki/Complex_normal_distribution#Circularly-symmetric_normal_distribution">circularly-symmetric complex normal distribution</a>.</p>
<section id="power-ampitude-spectral-density-generation-psd-asd">
<h4>Power/Ampitude-spectral-density generation (PSD/ASD)<a class="headerlink" href="#power-ampitude-spectral-density-generation-psd-asd" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Average over data (normally do this)</p>
<ul>
<li><p>Divide a long chunk of data and average the power in each chunk</p></li>
<li><p>Assumes the PSD does not vary with time</p></li>
<li><p>Assumes data are Gaussian over the full time stretch</p></li>
<li><p>Has well defined statistical uncertainty</p></li>
</ul>
</li>
<li><p>Fit a parameterised model to the data (eg using instrumental info from Dan Brown’s talk)</p>
<ul>
<li><p>E.g., <code class="docutils literal notranslate"><span class="pre">BayesLine</span></code></p></li>
<li><p>Describing the PSD requires lots of parameters</p></li>
<li><p>Estimating all these parameters is difficult and computationally expensive</p></li>
<li><p>Especially expensive marginalise over the uncertainty in the model while fitting CBC signal models</p></li>
</ul>
</li>
</ul>
</section>
<section id="glitches">
<h4>Glitches<a class="headerlink" href="#glitches" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Short term, terrestrial, non-Gaussian transients</p></li>
<li><p>Can bias parameter estimation if overlapping signal</p></li>
<li><p>Can bias PSD estimation
To mitigate:</p></li>
<li><p>Zero out data containing glitch, “gating”</p>
<ul>
<li><p>Also potentially removes signal</p></li>
<li><p>Can bias PSD estimation if care is not taken</p></li>
</ul>
</li>
<li><p>Fit a parameterised model to remove the glitch</p>
<ul>
<li><p>E.g., <code class="docutils literal notranslate"><span class="pre">BayesWave</span></code></p></li>
<li><p>Describing the PSD requires lots of parameters</p></li>
<li><p>Estimating all these parameters is difficult and computationally expensive</p></li>
<li><p>Especially expensive marginalise over the uncertainty in the model while fitting CBC signal models</p></li>
</ul>
</li>
</ul>
</section>
<section id="lines">
<h4>Lines<a class="headerlink" href="#lines" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Data at specific frequencies are persistently non-Gaussian and non-stationary</p></li>
<li><p>Large amplitude can cause spectral leakage</p>
<ul>
<li><p>Need to apply a window</p></li>
</ul>
</li>
<li><p>Many have known causes</p>
<ul>
<li><p>Suspension “violin” modes</p></li>
<li><p>Calibration lines</p></li>
<li><p>Mains power lines</p></li>
<li><p>…</p></li>
</ul>
</li>
<li><p>Some can be subtracted (“cleaned”) from the data stream</p></li>
<li><p>Can be correlated between detectors</p></li>
<li><p>Commonly not analysed when searching for long-duration signals</p></li>
<li><p>Included in compact binary coalescence parameter estimation (for now…)</p></li>
</ul>
</section>
</section>
</section>
<section id="create-priors-for-analysis">
<h2>Create priors for analysis<a class="headerlink" href="#create-priors-for-analysis" title="Permalink to this headline">#</a></h2>
<p>Since sampling all parameters will take a long time, we set delta-functions to all but one mass parameter (chirp-mass).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We sample in chirp-mass and mass-ratio, however--these are quite un-astrophysical priors</span>
<span class="c1"># but in post-processing convert to uniform-in-component masses </span>
<span class="n">priors</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">BBHPriorDict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
    <span class="s2">&quot;a_1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;a_2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tilt_1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tilt_2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phi_12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phi_jl&quot;</span><span class="p">,</span>
    <span class="s2">&quot;psi&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ra&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dec&quot;</span><span class="p">,</span>
    <span class="s2">&quot;geocent_time&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phase&quot;</span><span class="p">,</span>
    <span class="s2">&quot;theta_jn&quot;</span><span class="p">,</span>
    <span class="s2">&quot;luminosity_distance&quot;</span><span class="p">,</span>
<span class="p">]:</span>
    <span class="n">priors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">injection_parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="n">priors</span><span class="p">[</span><span class="s2">&quot;mass_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inj_q</span>
<span class="n">priors</span><span class="p">[</span><span class="s2">&quot;chirp_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">UniformInComponentsChirpMass</span><span class="p">(</span>
    <span class="n">minimum</span><span class="o">=</span><span class="n">inj_chirp_mass</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">maximum</span><span class="o">=</span><span class="n">inj_chirp_mass</span> <span class="o">+</span> <span class="mi">5</span>
<span class="p">)</span>

<span class="c1"># Perform a check that the prior does not extend to a parameter space longer than the data</span>
<span class="n">priors</span><span class="o">.</span><span class="n">validate_prior</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">min_freq</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Making some plots of the priors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc</span> <span class="o">=</span> <span class="n">priors</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)[</span><span class="s1">&#39;chirp_mass&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Chirp Mass &quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$M_{\odot}$&quot;</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-the-likelihood-to-use-for-analysis">
<h2>Create the likelihood to use for analysis<a class="headerlink" href="#create-the-likelihood-to-use-for-analysis" title="Permalink to this headline">#</a></h2>
<p>Similar to the line-signal in Gaussian noise case, we assume that the GW signal is embedded in some Gaussian noise. We also assume that the noise is stationary.</p>
<p>With these asumptions, we can use the <a class="reference external" href="https://en.wikipedia.org/wiki/Whittle_likelihood">Whittle likelihood</a>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-f5f69ced-a466-43e6-aaa0-282b95cf844b">
<span class="eqno">(14)<a class="headerlink" href="#equation-f5f69ced-a466-43e6-aaa0-282b95cf844b" title="Permalink to this equation">#</a></span>\[\begin{align}
\mathcal{L}(d | \theta) = \prod^{\rm{H, L, V}}_{i}\ \prod^{20-2048Hz}_{j} \frac{1}{2 \pi\  \rm{PSD}_{i,j} } \exp\left( -\frac{|\tilde{d}_{i,j} - \tilde{h}_{i,j}(\theta)|^2}{2\ \rm{PSD}_{i,j} } \right).
\end{align}\]</div>
<p>Here:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">d</span></code> is the frequency-domain strain data,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">h</span></code> is the template waveform</p></li>
</ul>
<p>This can be instantiated in bilby like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the IFOs contain the data and PSD for each detector</span>
<span class="c1"># the waveform generator can generate differnt h(t)</span>
<span class="n">likelihood</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">GravitationalWaveTransient</span><span class="p">(</span>
    <span class="n">interferometers</span><span class="o">=</span><span class="n">ifos</span><span class="p">,</span> 
    <span class="n">waveform_generator</span><span class="o">=</span><span class="n">waveform_generator</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-inference">
<h2>Run inference<a class="headerlink" href="#run-inference" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">RE_RUN_SLOW_CELLS</span><span class="p">:</span>
    <span class="c1"># Run sampler.  In this case we&#39;re going to use the `dynesty` sampler</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">run_sampler</span><span class="p">(</span>
        <span class="n">likelihood</span><span class="o">=</span><span class="n">likelihood</span><span class="p">,</span>
        <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span>
        <span class="n">sampler</span><span class="o">=</span><span class="s2">&quot;dynesty&quot;</span><span class="p">,</span>
        <span class="n">npoints</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
        <span class="n">nlive</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">walks</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
        <span class="n">dlogz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">injection_parameters</span><span class="o">=</span><span class="n">injection_parameters</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;injection&quot;</span><span class="p">,</span>
        <span class="n">conversion_function</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">generate_all_bbh_parameters</span><span class="p">,</span>
        <span class="n">result_class</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">CBCResult</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping sampling...&quot;</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s2">/injection_result.json&quot;</span>
    <span class="n">download</span><span class="p">(</span><span class="n">INJECTION_URL</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">CBCResult</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded result!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="make-some-plots">
<h2>Make some plots<a class="headerlink" href="#make-some-plots" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mass_1&quot;</span><span class="p">,</span> <span class="s2">&quot;mass_2&quot;</span><span class="p">],</span> <span class="n">truths</span><span class="o">=</span><span class="p">[</span><span class="n">inj_m1</span><span class="p">,</span> <span class="n">inj_m2</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">interferometer</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">:</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot_interferometer_waveform_posterior</span><span class="p">(</span>
        <span class="n">interferometer</span><span class="o">=</span><span class="n">interferometer</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cleanup">
<h2>Cleanup<a class="headerlink" href="#cleanup" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lets clear up some memory before proceeding to the next section!</span>
<span class="k">del</span> <span class="n">result</span>
<span class="k">del</span> <span class="n">ifos</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="analysis-of-gw150914">
<h1>Analysis of GW150914<a class="headerlink" href="#analysis-of-gw150914" title="Permalink to this headline">#</a></h1>
<p>Lets analyse a real event!</p>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h2>
<p>First we import some functions so we dont need to put in the full path</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">bilby</span>
<span class="kn">from</span> <span class="nn">bilby</span> <span class="kn">import</span> <span class="n">run_sampler</span>
<span class="kn">from</span> <span class="nn">bilby.core.prior</span> <span class="kn">import</span> <span class="n">Constraint</span><span class="p">,</span> <span class="n">Uniform</span>
<span class="kn">from</span> <span class="nn">bilby.gw.conversion</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">convert_to_lal_binary_black_hole_parameters</span><span class="p">,</span>
    <span class="n">generate_all_bbh_parameters</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">bilby.gw.detector.networks</span> <span class="kn">import</span> <span class="n">InterferometerList</span>
<span class="kn">from</span> <span class="nn">bilby.gw.detector.psd</span> <span class="kn">import</span> <span class="n">PowerSpectralDensity</span>
<span class="kn">from</span> <span class="nn">bilby.gw.likelihood</span> <span class="kn">import</span> <span class="n">GravitationalWaveTransient</span>
<span class="kn">from</span> <span class="nn">bilby.gw.prior</span> <span class="kn">import</span> <span class="n">BBHPriorDict</span>
<span class="kn">from</span> <span class="nn">bilby.gw.result</span> <span class="kn">import</span> <span class="n">CBCResult</span>
<span class="kn">from</span> <span class="nn">bilby.gw.source</span> <span class="kn">import</span> <span class="n">lal_binary_black_hole</span>
<span class="kn">from</span> <span class="nn">bilby.gw.utils</span> <span class="kn">import</span> <span class="n">get_event_time</span>
<span class="kn">from</span> <span class="nn">bilby.gw.waveform_generator</span> <span class="kn">import</span> <span class="n">WaveformGenerator</span>
<span class="kn">from</span> <span class="nn">gwpy.plot</span> <span class="kn">import</span> <span class="n">Plot</span> <span class="k">as</span> <span class="n">GWpyPlot</span>
<span class="kn">from</span> <span class="nn">gwpy.timeseries</span> <span class="kn">import</span> <span class="n">TimeSeries</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span> 
<span class="n">bilby_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;bilby&quot;</span><span class="p">)</span>
<span class="n">bilby_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="downloading-ifo-data">
<h2>Downloading IFO data<a class="headerlink" href="#downloading-ifo-data" title="Permalink to this headline">#</a></h2>
<p>Now we download the raw data and make some plots</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">download_strain</span><span class="p">(</span><span class="n">ifo_name</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">outdir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download strain data from GWOSC&quot;&quot;&quot;</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ifo_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">.hdf5&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">fetch_open_data</span><span class="p">(</span><span class="n">ifo_name</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="n">interferometers</span> <span class="o">=</span> <span class="n">InterferometerList</span><span class="p">([</span><span class="s2">&quot;H1&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">])</span>
<span class="n">trigger_time</span> <span class="o">=</span> <span class="n">get_event_time</span><span class="p">(</span><span class="s2">&quot;GW150914&quot;</span><span class="p">)</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">trigger_time</span> <span class="o">-</span> <span class="mi">3</span>
<span class="n">duration</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">duration</span>
<span class="n">roll_off</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="c1"># Get raw data</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">interferometers</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Getting </span><span class="si">{</span><span class="n">ifo</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> analysis data segment (can take ~ 30s)&quot;</span>
    <span class="p">)</span>
    <span class="n">analysis_data</span> <span class="o">=</span> <span class="n">download_strain</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span><span class="p">)</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">strain_data</span><span class="o">.</span><span class="n">roll_off</span> <span class="o">=</span> <span class="n">roll_off</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">strain_data</span><span class="o">.</span><span class="n">set_from_gwpy_timeseries</span><span class="p">(</span><span class="n">analysis_data</span><span class="p">)</span>
    <span class="n">raw_data</span><span class="p">[</span><span class="n">ifo</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis_data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot raw data:</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">GWpyPlot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;auto-gps&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ifo_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ifo_name</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="mf">1126259462.427</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1126259462</span><span class="p">,</span> <span class="mf">1126259462.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Strain noise&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Woah. That looks terrible. Where is the nobel-prize winning poster-child signal?</p>
<p>We may need to clean up the data a bit to actually ‘see’ the signal. Lets get the data for the PSD and take a look at the noise once again</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># downloading data</span>
<span class="n">psd_start_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">duration</span>
<span class="n">psd_duration</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">psd_end_time</span> <span class="o">=</span> <span class="n">psd_start_time</span> <span class="o">+</span> <span class="n">psd_duration</span>
<span class="n">psd_tukey_alpha</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">roll_off</span> <span class="o">/</span> <span class="n">duration</span>
<span class="n">overlap</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">2</span>

<span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">interferometers</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Getting </span><span class="si">{</span><span class="n">ifo</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> PSD data segment (can take ~ 1min)&quot;</span>
    <span class="p">)</span>
    <span class="n">psd_data</span> <span class="o">=</span> <span class="n">download_strain</span><span class="p">(</span>
        <span class="n">ifo</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">psd_start_time</span><span class="p">,</span> <span class="n">psd_end_time</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span>
    <span class="p">)</span>
    <span class="n">psd</span> <span class="o">=</span> <span class="n">psd_data</span><span class="o">.</span><span class="n">psd</span><span class="p">(</span>
        <span class="n">fftlength</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;tukey&quot;</span><span class="p">,</span> <span class="n">psd_tukey_alpha</span><span class="p">),</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;median&quot;</span>
    <span class="p">)</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">power_spectral_density</span> <span class="o">=</span> <span class="n">PowerSpectralDensity</span><span class="p">(</span>
        <span class="n">frequency_array</span><span class="o">=</span><span class="n">psd</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">psd_array</span><span class="o">=</span><span class="n">psd</span><span class="o">.</span><span class="n">value</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plotting</span>
<span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">interferometers</span><span class="p">:</span>
    <span class="n">analysis_data</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">frequency_domain_strain</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">frequency_array</span><span class="p">,</span> <span class="n">analysis_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Analysis Data&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">frequency_array</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">amplitude_spectral_density_array</span><span class="p">),</span>
               <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ASD (estimated noise)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">minimum_frequency</span><span class="p">,</span> <span class="n">ifo</span><span class="o">.</span><span class="n">maximum_frequency</span><span class="p">)</span>
    <span class="n">ymin_max</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">analysis_data</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">analysis_data</span><span class="p">)]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span> <span class="o">*</span><span class="n">ymin_max</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">ymin_max</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency [Hz]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Strain [strain/$\sqrt{\rm Hz}$]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ifo</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> data&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">*</span><span class="n">ymin_max</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Lets <code class="docutils literal notranslate"><span class="pre">notch</span></code> out the 60 and 120 Hz <code class="docutils literal notranslate"><span class="pre">violin</span></code> modes (black vertical lines), and only keep data within the 50-250Hz range (marked in green) from the raw data and re-plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">GWpyPlot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;auto-gps&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ifo_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">bandpass</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span><span class="o">.</span><span class="n">notch</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">notch</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ifo_name</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="mf">1126259462.427</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1126259462</span><span class="p">,</span> <span class="mf">1126259462.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1e-21</span><span class="p">,</span> <span class="mf">1e-21</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Strain noise&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Noiceee… Lets plot the signals in the frequency domain:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span> <span class="o">=</span> <span class="n">trigger_time</span>

<span class="k">for</span> <span class="n">ifo_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">qtrans</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">q_transform</span><span class="p">(</span>
        <span class="n">frange</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">500</span><span class="p">),</span> <span class="n">fres</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">outseg</span><span class="o">=</span><span class="p">(</span><span class="n">tc</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">tc</span><span class="o">+</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="n">qtrans</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">150</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ifo_name</span><span class="si">}</span><span class="s1"> Q-transform&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="n">trigger_time</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="getting-priors">
<h2>Getting priors<a class="headerlink" href="#getting-priors" title="Permalink to this headline">#</a></h2>
<p>Now lets write down our priors for this event’s analysis. Note that again we set several delta functions and restrict the search space to speed up analysis for the sake of this tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># setup the prior</span>
<span class="kn">from</span> <span class="nn">bilby.core.prior</span> <span class="kn">import</span> <span class="n">Uniform</span><span class="p">,</span> <span class="n">PowerLaw</span><span class="p">,</span> <span class="n">Sine</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">,</span> <span class="n">Cosine</span>
<span class="kn">from</span> <span class="nn">corner</span> <span class="kn">import</span> <span class="n">corner</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># typically we would use a priors with wide bounds:</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">trigger_time</span>
<span class="n">priors</span> <span class="o">=</span> <span class="n">BBHPriorDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">mass_ratio</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mass_ratio&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">chirp_mass</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;chirp_mass&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">31</span><span class="p">),</span>
    <span class="n">mass_1</span><span class="o">=</span><span class="n">Constraint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mass_1&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">80</span><span class="p">),</span>
    <span class="n">mass_2</span><span class="o">=</span><span class="n">Constraint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mass_2&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">80</span><span class="p">),</span>
    <span class="n">a_1</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;a_1&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mf">0.99</span><span class="p">),</span>
    <span class="n">a_2</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;a_2&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mf">0.99</span><span class="p">),</span>
    <span class="n">tilt_1</span><span class="o">=</span><span class="n">Sine</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tilt_1&#39;</span><span class="p">),</span>
    <span class="n">tilt_2</span><span class="o">=</span><span class="n">Sine</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tilt_2&#39;</span><span class="p">),</span>
    <span class="n">phi_12</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;phi_12&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;periodic&#39;</span><span class="p">),</span>
    <span class="n">phi_jl</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;phi_jl&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;periodic&#39;</span><span class="p">),</span>
    <span class="n">luminosity_distance</span><span class="o">=</span><span class="n">PowerLaw</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;luminosity_distance&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">2000</span><span class="p">),</span>
    <span class="n">dec</span><span class="o">=</span><span class="n">Cosine</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dec&#39;</span><span class="p">),</span>
    <span class="n">ra</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;periodic&#39;</span><span class="p">),</span>
    <span class="n">theta_jn</span><span class="o">=</span><span class="n">Sine</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;theta_jn&#39;</span><span class="p">),</span>
    <span class="n">psi</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;psi&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;periodic&#39;</span><span class="p">),</span>
    <span class="n">phase</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;phase&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;periodic&#39;</span><span class="p">),</span>
    <span class="n">geocent_time</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">minimum</span><span class="o">=</span><span class="n">tc</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="n">tc</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">latex_label</span><span class="o">=</span><span class="s2">&quot;$t_c$&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;$s$&quot;</span><span class="p">)</span>
<span class="p">))</span>

<span class="c1"># HACK: for this example (to make analysis faster) we will use a prior with tighter bounds</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;luminosity_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">419.18</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;mass_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mass_1&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;mass_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mass_2&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.269</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.223</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;geocent_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tc</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;theta_jn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.921</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;phi_jl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.968</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;psi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.659</span>
<span class="c1"># dont do this in a real run </span>

<span class="n">prior_samples</span> <span class="o">=</span> <span class="n">priors</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">prior_samples_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">prior_samples</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plots of some priors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;chirp_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;a_1&#39;</span><span class="p">,</span> <span class="s1">&#39;a_2&#39;</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="p">(</span>
    <span class="n">prior_samples_df</span><span class="p">[</span><span class="n">parameters</span><span class="p">],</span> <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
    <span class="n">plot_contours</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:gray&quot;</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lets convert some parameters and see what the prior-distributions we get</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bilby.gw.conversion</span> <span class="kn">import</span> <span class="n">generate_mass_parameters</span>

<span class="n">prior_samples</span> <span class="o">=</span> <span class="n">generate_mass_parameters</span><span class="p">(</span><span class="n">prior_samples</span><span class="p">)</span>
<span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;cos_tilt_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;tilt_1&#39;</span><span class="p">])</span>
<span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;cos_tilt_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;tilt_2&#39;</span><span class="p">])</span>
<span class="n">s1z</span> <span class="o">=</span> <span class="n">prior_samples</span><span class="p">[</span><span class="s2">&quot;a_1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;cos_tilt_1&#39;</span><span class="p">]</span>
<span class="n">s2z</span> <span class="o">=</span> <span class="n">prior_samples</span><span class="p">[</span><span class="s2">&quot;a_2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;cos_tilt_2&#39;</span><span class="p">]</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;mass_ratio&#39;</span><span class="p">]</span>
<span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;chi_eff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">s1z</span> <span class="o">+</span> <span class="n">s2z</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
<span class="n">prior_samples_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">prior_samples</span><span class="p">)</span>
<span class="n">prior_samples_df</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mass_1&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_2&#39;</span><span class="p">,</span> <span class="s1">&#39;chi_eff&#39;</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="p">(</span>
    <span class="n">prior_samples_df</span><span class="p">[</span><span class="n">parameters</span><span class="p">],</span>
    <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_contours</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:gray&quot;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="inference-step">
<h2>Inference step<a class="headerlink" href="#inference-step" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waveform_generator</span> <span class="o">=</span> <span class="n">WaveformGenerator</span><span class="p">(</span>
    <span class="n">duration</span><span class="o">=</span><span class="n">interferometers</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
    <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">interferometers</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">,</span>
    <span class="n">frequency_domain_source_model</span><span class="o">=</span><span class="n">lal_binary_black_hole</span><span class="p">,</span>
    <span class="n">parameter_conversion</span><span class="o">=</span><span class="n">convert_to_lal_binary_black_hole_parameters</span><span class="p">,</span>
    <span class="n">waveform_arguments</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">waveform_approximant</span><span class="o">=</span><span class="s2">&quot;IMRPhenomPv2&quot;</span><span class="p">,</span>
        <span class="n">reference_frequency</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">likelihood</span> <span class="o">=</span> <span class="n">GravitationalWaveTransient</span><span class="p">(</span>
    <span class="n">interferometers</span><span class="o">=</span><span class="n">interferometers</span><span class="p">,</span> <span class="n">waveform_generator</span><span class="o">=</span><span class="n">waveform_generator</span><span class="p">,</span>
    <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span> <span class="n">time_marginalization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">distance_marginalization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">phase_marginalization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">jitter_time</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>


<span class="k">if</span> <span class="n">RE_RUN_SLOW_CELLS</span><span class="p">:</span>
    <span class="n">bilby_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">run_sampler</span><span class="p">(</span>
        <span class="n">likelihood</span><span class="o">=</span><span class="n">likelihood</span><span class="p">,</span> <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GW150914&quot;</span><span class="p">,</span>
        <span class="n">nlive</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">walks</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="c1"># HACK: use defaults nlive/walks (much more aggressive)</span>
        <span class="n">conversion_function</span><span class="o">=</span><span class="n">generate_all_bbh_parameters</span><span class="p">,</span>
        <span class="n">result_class</span><span class="o">=</span><span class="n">CBCResult</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping sampling...&quot;</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s2">/GW150914_result.json&quot;</span>
    <span class="n">download</span><span class="p">(</span><span class="n">GW150914_URL</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">CBCResult</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded result!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mass_ratio&quot;</span><span class="p">,</span> <span class="s2">&quot;chi_eff&quot;</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mass_1&quot;</span><span class="p">,</span> <span class="s2">&quot;mass_2&quot;</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>NOTE: To get some proper results, we’d have to run with more robust sampler settings and wider priors.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="accessing-gwtc-parameter-estimation-results">
<h1>Accessing GWTC parameter estimation results<a class="headerlink" href="#accessing-gwtc-parameter-estimation-results" title="Permalink to this headline">#</a></h1>
<p>The GWTC data and parameter estimation results are all online (eg https://zenodo.org/record/5546663).
Lets download one result and make some plots:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">OUTDIR</span><span class="o">=</span><span class="s2">&quot;outdir/&quot;</span>
<span class="n">GW200308_fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s2">/GW200308_result.h5&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">GW200308_URL</span><span class="p">,</span> <span class="n">GW200308_fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>
<span class="n">GW200308_result</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">GW200308_fn</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GW200308 samples loaded!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lets look at what is stored:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">GW200308_result</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">GW200308_result</span><span class="p">[</span><span class="s1">&#39;C01:IMRPhenomXPHM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameters stored:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">GW200308_result</span><span class="p">[</span><span class="s1">&#39;C01:IMRPhenomXPHM&#39;</span><span class="p">][</span><span class="s1">&#39;posterior_samples&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xphm_mc</span> <span class="o">=</span> <span class="n">GW200308_result</span><span class="p">[</span><span class="s1">&#39;C01:IMRPhenomXPHM&#39;</span><span class="p">][</span><span class="s1">&#39;posterior_samples&#39;</span><span class="p">][</span><span class="s1">&#39;chirp_mass&#39;</span><span class="p">][:]</span>
<span class="n">seob_mc</span> <span class="o">=</span> <span class="n">GW200308_result</span><span class="p">[</span><span class="s1">&#39;C01:SEOBNRv4PHM&#39;</span><span class="p">][</span><span class="s1">&#39;posterior_samples&#39;</span><span class="p">][</span><span class="s1">&#39;chirp_mass&#39;</span><span class="p">][:]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">xphm_mc</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;XPHM&#39;</span><span class="p">,</span>  <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">seob_mc</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>  <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SEOB&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Chirp-mass Msun&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</section>


<script type="application/vnd.jupyter.widget-state+json">
{"state": {"0ed921b59e97432bbe7d704f3ebf42f6": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "1488802763da42fd9048d3bc7837ae5c": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "15a14e391f6c4d1b92282f121112176f": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "1725386a626242dba849dd3cdd09b709": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "19e3aad6a056425ab1160d3bfd6d8f3a": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HBoxModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_2aa4dd8c2f694c798682136d5127c245", "IPY_MODEL_f95b5a5847f4450fbcf8f5cfc5f61959", "IPY_MODEL_e133a2ee45bb4e1ab0885be91aad6339"], "layout": "IPY_MODEL_a394ccf9affe40579a3204fb43276305"}}, "2aa4dd8c2f694c798682136d5127c245": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_db35c9f5914649018a315892ca91a043", "placeholder": "\u200b", "style": "IPY_MODEL_e8fb0a9e0d4e4996b14e2cf6b5a7a115", "value": "Downloading outdir//GW200308_result.h5: 100%"}}, "320ec00ee09c4189937c748c8a4a2236": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "34d7fbc87982476693c3868f73cc225d": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "4ced6512a6454fc689d858c13b146311": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "5e5fc4d8b9454de581ca6c6328d5d05e": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "ProgressStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "62afe1f44e51472081fcaaa7ea091459": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "6a908bcf8a4b4bd7a758e9ad569ae74d": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "6b7d5bc7b2774188aa63bacdb3c5b575": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "FloatProgressModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_15a14e391f6c4d1b92282f121112176f", "max": 10000.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_5e5fc4d8b9454de581ca6c6328d5d05e", "value": 10000.0}}, "7759fb74c3d44eba9ca73e365f27461c": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_e550de4e3def431886f436835bf6185c", "placeholder": "\u200b", "style": "IPY_MODEL_0ed921b59e97432bbe7d704f3ebf42f6", "value": "Downloading outdir/GW150914_result.json: "}}, "7f031f4f763b4f559ee4a851c14c6d7c": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HBoxModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_b14770ef7b964639acefe1af216ebf7d", "IPY_MODEL_6b7d5bc7b2774188aa63bacdb3c5b575", "IPY_MODEL_d37858cbf00448cb9fc6aa2633f81c39"], "layout": "IPY_MODEL_c5d8f5fb522041918834af182694bb89"}}, "8cbf232fe56a47ebb9a560efa5c317df": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "99c39331ecc046c782c805915bdf1571": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "a394ccf9affe40579a3204fb43276305": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "a990ed62e875465595edb850316dce76": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "b14770ef7b964639acefe1af216ebf7d": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_1725386a626242dba849dd3cdd09b709", "placeholder": "\u200b", "style": "IPY_MODEL_320ec00ee09c4189937c748c8a4a2236", "value": "Brute force LnL computation: 100%"}}, "b2ac48b4ffc34ad8ad398d405446d21d": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "ProgressStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "c5d8f5fb522041918834af182694bb89": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "c9d9d6d17f1c4f65acd40cec5dafe2dc": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "ProgressStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "d37858cbf00448cb9fc6aa2633f81c39": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_1488802763da42fd9048d3bc7837ae5c", "placeholder": "\u200b", "style": "IPY_MODEL_34d7fbc87982476693c3868f73cc225d", "value": " 10000/10000 [00:01&lt;00:00, 9370.19it/s]"}}, "d917e02dc84246bd96f777cc2a615e08": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_a990ed62e875465595edb850316dce76", "placeholder": "\u200b", "style": "IPY_MODEL_8cbf232fe56a47ebb9a560efa5c317df", "value": " 205M/0.00 [03:17&lt;00:00, 660kiB/s]"}}, "db35c9f5914649018a315892ca91a043": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "dc728376bd0a4c1c919bc0ba78bc984b": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "FloatProgressModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_f8ddd54c689a442aaafe3c9e9e5203f7", "max": 1.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_c9d9d6d17f1c4f65acd40cec5dafe2dc", "value": 1.0}}, "e133a2ee45bb4e1ab0885be91aad6339": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_62afe1f44e51472081fcaaa7ea091459", "placeholder": "\u200b", "style": "IPY_MODEL_6a908bcf8a4b4bd7a758e9ad569ae74d", "value": " 20.1M/20.1M [01:59&lt;00:00, 187kiB/s]"}}, "e550de4e3def431886f436835bf6185c": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "e8fb0a9e0d4e4996b14e2cf6b5a7a115": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "f5fb8cb3d353480bb8319f936d8c8f26": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HBoxModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_7759fb74c3d44eba9ca73e365f27461c", "IPY_MODEL_dc728376bd0a4c1c919bc0ba78bc984b", "IPY_MODEL_d917e02dc84246bd96f777cc2a615e08"], "layout": "IPY_MODEL_99c39331ecc046c782c805915bdf1571"}}, "f8ddd54c689a442aaafe3c9e9e5203f7": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": "20px"}}, "f95b5a5847f4450fbcf8f5cfc5f61959": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "FloatProgressModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_4ced6512a6454fc689d858c13b146311", "max": 21106848.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_b2ac48b4ffc34ad8ad398d405446d21d", "value": 21106848.0}}}, "version_major": 2, "version_minor": 0}
</script>


    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "venv"
        },
        kernelOptions: {
            name: "venv",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'venv'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="workshop_notebook.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Parameter estimation tutorial</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="notebook_profile.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notebook time/memory profile</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Avi Vajpeyi<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>