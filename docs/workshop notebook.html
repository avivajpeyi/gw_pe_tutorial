
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parameter estimation tutorial &#8212; NZ-GW workshop</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/tabs.js"></script>
    <script >let toggleHintShow = 'Click to show';</script>
    <script >let toggleHintHide = 'Click to hide';</script>
    <script >let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script >const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">NZ-GW workshop</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1 current">
  <a class="reference internal" href="#">
   Parameter estimation tutorial
  </a>
 </li>
</ul>
    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/workshop notebook.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/avivajpeyi/nz_gravity_workshop/main?urlpath=tree/src/workshop notebook.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/avivajpeyi/nz_gravity_workshop/blob/main/src/workshop notebook.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Parameter estimation tutorial
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bayesian-inference-intro">
   Bayesian Inference intro
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#signal-model">
     Signal Model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#priors">
     Priors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#likelihood">
     Likelihood
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#brute-force-posterior-computation">
     Brute force posterior computation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampling-from-the-posterior">
     Sampling from the posterior
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cbc-gw-signal-model">
   CBC GW  Signal Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cbc-parameter-estimation">
   CBC Parameter Estimation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulate-a-signal">
     Simulate a signal
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inject-the-signal-into-an-interferometer-s-data-stream">
     Inject the signal into an interferometer’s data stream
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#notes-about-noise">
       Notes about noise:
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#power-ampitude-spectral-density-generation-psd-asd">
         Power/Ampitude-spectral-density generation (PSD/ASD)
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#glitches">
         Glitches
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#lines">
         Lines
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-priors-for-analysis">
     Create priors for analysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-likelihood-to-use-for-analysis">
     Create the likelihood to use for analysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-inference">
     Run inference
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#make-some-plots">
     Make some plots
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cleanup">
     Cleanup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis-of-gw150914">
   Analysis of GW150914
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#downloading-ifo-data">
     Downloading IFO data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getting-priors">
     Getting priors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inference-step">
     Inference step
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#accessing-gwtc-parameter-estimation-results">
   Accessing GWTC parameter estimation results
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Parameter estimation tutorial</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Parameter estimation tutorial
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bayesian-inference-intro">
   Bayesian Inference intro
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#signal-model">
     Signal Model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#priors">
     Priors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#likelihood">
     Likelihood
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#brute-force-posterior-computation">
     Brute force posterior computation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampling-from-the-posterior">
     Sampling from the posterior
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cbc-gw-signal-model">
   CBC GW  Signal Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cbc-parameter-estimation">
   CBC Parameter Estimation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulate-a-signal">
     Simulate a signal
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inject-the-signal-into-an-interferometer-s-data-stream">
     Inject the signal into an interferometer’s data stream
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#notes-about-noise">
       Notes about noise:
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#power-ampitude-spectral-density-generation-psd-asd">
         Power/Ampitude-spectral-density generation (PSD/ASD)
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#glitches">
         Glitches
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#lines">
         Lines
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-priors-for-analysis">
     Create priors for analysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-likelihood-to-use-for-analysis">
     Create the likelihood to use for analysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-inference">
     Run inference
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#make-some-plots">
     Make some plots
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cleanup">
     Cleanup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis-of-gw150914">
   Analysis of GW150914
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#downloading-ifo-data">
     Downloading IFO data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getting-priors">
     Getting priors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inference-step">
     Inference step
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#accessing-gwtc-parameter-estimation-results">
   Accessing GWTC parameter estimation results
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="parameter-estimation-tutorial">
<h1>Parameter estimation tutorial<a class="headerlink" href="#parameter-estimation-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> pip install bilby<span class="o">[</span>gw<span class="o">]</span> --upgrade -q
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bilby</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">corner.core</span> <span class="kn">import</span> <span class="n">quantile</span>
<span class="kn">from</span> <span class="nn">corner</span> <span class="kn">import</span> <span class="n">corner</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">warnings</span>


<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">INJECTION_URL</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.zenodo.org/record/1163982/files/injection_result.json?download=1&quot;</span>
<span class="n">GW150914_URL</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.zenodo.org/record/1164558/files/GW150914_result.json?download=1&quot;</span>
<span class="n">GW200308_URL</span> <span class="o">=</span> <span class="s2">&quot;https://zenodo.org/record/5546663/files/IGWN-GWTC3p0-v1-GW200308_173609_PEDataRelease_mixed_cosmo.h5?download=1&quot;</span>



<span class="k">def</span> <span class="nf">notebook_setup</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;bilby&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;savefig.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sans-serif&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.sans-serif&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Liberation Sans&quot;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.cursive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Liberation Sans&quot;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;mathtext.fontset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;custom&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">,</span> <span class="n">tqdm</span><span class="p">(</span>
        <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Downloading </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;iB&#39;</span><span class="p">,</span>
        <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">unit_divisor</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">bar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">):</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            


<span class="n">notebook_setup</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RE_RUN_SLOW_CELLS</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">OUTDIR</span> <span class="o">=</span> <span class="s2">&quot;outdir&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="bayesian-inference-intro">
<h1>Bayesian Inference intro<a class="headerlink" href="#bayesian-inference-intro" title="Permalink to this headline">¶</a></h1>
<p>To start, lets take a look at Bayes’ theorem:</p>
<div class="amsmath math notranslate nohighlight" id="equation-5614caab-f34b-4cd0-b489-141ec65a4cf0">
<span class="eqno">(1)<a class="headerlink" href="#equation-5614caab-f34b-4cd0-b489-141ec65a4cf0" title="Permalink to this equation">¶</a></span>\[\begin{align}
\rm{Posterior} &amp;= \frac{\rm{Prior} * \rm{Likelihood}}{\rm{Evidence}}  \\
\implies P(\theta|\rm{data}) &amp;= \frac{\pi(\theta)\  \mathcal{L}(\rm{data}|\theta)}{\int_{\theta} \pi(\theta)\ \mathcal{L}(\rm{data}|\theta)\ d\theta}\\
 &amp;= \frac{\pi(\theta)\  \mathcal{L}(\rm{data}|\theta)}{\mathcal{Z}(data)}
\end{align}\]</div>
<p>For a primer on Bayesian inference in GW, please look at <a class="reference external" href="https://arxiv.org/abs/1809.02293">Eric Thrane + Colm Talbot’s paper</a>.</p>
<p>In this workshop we will focus more on how we can perform inference and not focus too much on the maths.</p>
<p>Lets look at an example of how we can use Bayesian inference to analyse the following data:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">observation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="o">-</span><span class="mf">1.65</span><span class="p">,</span> <span class="mf">1.93</span><span class="p">,</span> <span class="mf">2.88</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.28</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.02</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">1.49</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.95</span><span class="p">,</span> 
    <span class="mf">3.64</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.47</span><span class="p">,</span> <span class="mf">3.91</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.16</span><span class="p">,</span> <span class="mf">1.03</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">6.96</span><span class="p">,</span> <span class="mf">1.07</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.69</span><span class="p">,</span> 
    <span class="o">-</span><span class="mf">7.18</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.94</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.37</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.09</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.07</span><span class="p">,</span> <span class="mf">6.28</span><span class="p">,</span> <span class="mf">1.73</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">4.11</span><span class="p">,</span>
    <span class="mf">1.29</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.21</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.06</span><span class="p">,</span> <span class="mf">3.67</span><span class="p">,</span> <span class="mf">0.91</span><span class="p">,</span> <span class="mf">0.64</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.51</span><span class="p">,</span> 
    <span class="mf">1.89</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.49</span><span class="p">,</span> <span class="mf">5.43</span><span class="p">,</span> <span class="mf">2.36</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">6.85</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">3.55</span><span class="p">,</span> 
    <span class="mf">3.43</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.98</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.06</span><span class="p">,</span> <span class="mf">6.79</span><span class="p">,</span> <span class="mf">3.27</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.62</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.16</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.19</span><span class="p">,</span>
    <span class="mf">1.75</span><span class="p">,</span> <span class="mf">6.18</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.72</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">4.85</span><span class="p">,</span> <span class="mf">6.83</span><span class="p">,</span> <span class="mf">10.35</span><span class="p">,</span> <span class="mf">3.83</span><span class="p">,</span> 
    <span class="mf">5.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.91</span><span class="p">,</span> <span class="mf">3.36</span><span class="p">,</span> <span class="mf">2.01</span><span class="p">,</span> <span class="mf">4.37</span><span class="p">,</span> <span class="mf">4.03</span><span class="p">,</span> <span class="mf">6.05</span><span class="p">,</span> <span class="mf">2.62</span><span class="p">,</span> 
    <span class="mf">5.16</span><span class="p">,</span> <span class="mf">3.57</span><span class="p">,</span> <span class="mf">3.74</span><span class="p">,</span> <span class="mf">7.07</span><span class="p">,</span> <span class="mf">3.89</span><span class="p">,</span> <span class="mf">9.91</span><span class="p">,</span> <span class="mf">3.89</span><span class="p">,</span> <span class="mf">3.41</span><span class="p">,</span> <span class="mf">7.71</span><span class="p">,</span> <span class="mf">2.79</span><span class="p">,</span>
    <span class="mf">3.98</span><span class="p">,</span> <span class="mf">4.91</span><span class="p">,</span> <span class="mf">1.87</span><span class="p">,</span> <span class="mf">2.65</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.42</span><span class="p">,</span> <span class="mf">11.26</span><span class="p">,</span> <span class="mf">5.06</span><span class="p">,</span> <span class="mf">8.83</span><span class="p">,</span> <span class="mf">2.87</span><span class="p">,</span> 
    <span class="mf">8.66</span><span class="p">,</span> <span class="mf">3.95</span><span class="p">,</span> <span class="mf">6.05</span><span class="p">,</span> <span class="mf">8.2</span><span class="p">,</span> <span class="mf">3.07</span><span class="p">,</span> <span class="mf">2.88</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">,</span> <span class="mf">3.84</span>
<span class="p">])</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span>
    <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> 
    <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.9</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> 
    <span class="mf">3.6</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">4.3</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">,</span> <span class="mf">4.7</span><span class="p">,</span> 
    <span class="mf">4.8</span><span class="p">,</span> <span class="mf">4.9</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">,</span> <span class="mf">5.3</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">,</span> <span class="mf">5.9</span><span class="p">,</span> 
    <span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.1</span><span class="p">,</span> <span class="mf">6.2</span><span class="p">,</span> <span class="mf">6.3</span><span class="p">,</span> <span class="mf">6.4</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">,</span> <span class="mf">6.7</span><span class="p">,</span> <span class="mf">6.8</span><span class="p">,</span> <span class="mf">6.9</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.1</span><span class="p">,</span> 
    <span class="mf">7.2</span><span class="p">,</span> <span class="mf">7.3</span><span class="p">,</span> <span class="mf">7.4</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mf">7.6</span><span class="p">,</span> <span class="mf">7.7</span><span class="p">,</span> <span class="mf">7.8</span><span class="p">,</span> <span class="mf">7.9</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">8.1</span><span class="p">,</span> <span class="mf">8.2</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">,</span> 
    <span class="mf">8.4</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mf">8.6</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">,</span> <span class="mf">8.8</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">9.1</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">,</span> <span class="mf">9.4</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">,</span> 
    <span class="mf">9.6</span><span class="p">,</span> <span class="mf">9.7</span><span class="p">,</span> <span class="mf">9.8</span><span class="p">,</span> <span class="mf">9.9</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;raw data&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>

<span class="n">plot_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_6_0.png" src="_images/workshop notebook_6_0.png" />
</div>
</div>
<p>Lets assume:</p>
<ol class="simple">
<li><p>The observed data <code class="docutils literal notranslate"><span class="pre">d(t)</span></code> consists of the following: <code class="docutils literal notranslate"><span class="pre">d(t)</span> <span class="pre">=</span> <span class="pre">n(t)</span> <span class="pre">+</span> <span class="pre">s(t)</span></code>.</p></li>
<li><p>The noise <code class="docutils literal notranslate"><span class="pre">n(t)</span></code> is <code class="docutils literal notranslate"><span class="pre">Gaussian</span> <span class="pre">white</span> <span class="pre">noise</span></code> (drawn from a Normal distribution).</p></li>
<li><p>The signal <code class="docutils literal notranslate"><span class="pre">s(t)</span></code> is a straight-line signal.</p></li>
</ol>
<p>With these assumptions, we can start implementing our Bayesian inference pipeline.</p>
<div class="section" id="signal-model">
<h2>Signal Model<a class="headerlink" href="#signal-model" title="Permalink to this headline">¶</a></h2>
<p>Assuming a straight line signal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">signal_model</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">time</span> <span class="o">*</span> <span class="n">m</span> <span class="o">+</span> <span class="n">c</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="priors">
<h2>Priors<a class="headerlink" href="#priors" title="Permalink to this headline">¶</a></h2>
<p>Now we can write down some priors on the parameters <code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code> of this model.
This is what we think our parameters can potentially be.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bilby</span>

<span class="n">priors</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">PriorDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">m</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">TruncatedNormal</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">),</span>
    <span class="n">c</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">),</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>To test our prior, lets draw some prior samples and print some samples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">priors</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>m</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.486700</td>
      <td>-3.440055</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.944357</td>
      <td>-4.419164</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.103103</td>
      <td>3.661761</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.836350</td>
      <td>1.011150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.196265</td>
      <td>2.080726</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Lets plot some histograms of these samples in a <code class="docutils literal notranslate"><span class="pre">corner</span></code> plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">corner</span> <span class="kn">import</span> <span class="n">corner</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">priors</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)),</span>
    <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
    <span class="n">plot_contours</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:gray&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_15_0.png" src="_images/workshop notebook_15_0.png" />
</div>
</div>
<p>Here each column/row represents one parameter.</p>
<p>The plots along the upper diagonal show the 1D histograms of the parameters.
In the above, these represent <code class="docutils literal notranslate"><span class="pre">pi(m)</span></code> and <code class="docutils literal notranslate"><span class="pre">pi(c)</span></code> – the prior distributions for <code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code>.</p>
<p>The plots on the inside of the corner show the 2D histograms for the intersecting parameters.
Here, the 2D join distribution is <code class="docutils literal notranslate"><span class="pre">pi(m,c)</span></code>.</p>
<p>At this point, lets test out our model and priors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_model_on_data</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">plot_each_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">],</span> <span class="n">samples</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
    
    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">signal_model</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">ci</span><span class="p">)</span> <span class="k">for</span> <span class="n">mi</span><span class="p">,</span> <span class="n">ci</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
    
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="n">y_low</span><span class="p">,</span> <span class="n">y_mean</span><span class="p">,</span> <span class="n">y_up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">y_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;mean model&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">y_low</span><span class="p">,</span> <span class="n">y_up</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;model 90%&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot_each_sample</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ys</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        
    <span class="n">plot_data</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>


    
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_model_on_data</span><span class="p">(</span><span class="n">priors</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_17_0.png" src="_images/workshop notebook_17_0.png" />
</div>
</div>
<p>Looks like the model can potentially fit the data! Lets try to use the Bayesian inference framework to help us get estimates on the model parameters.</p>
</div>
<div class="section" id="likelihood">
<h2>Likelihood<a class="headerlink" href="#likelihood" title="Permalink to this headline">¶</a></h2>
<p>Recall the assumption that <code class="docutils literal notranslate"><span class="pre">d(t)</span> <span class="pre">=</span> <span class="pre">n(t)</span> <span class="pre">+</span> <span class="pre">s(t)</span></code>, and that the noise is normally distributed. Using this, we can write:</p>
<div class="amsmath math notranslate nohighlight" id="equation-fff28a12-188b-469f-8d74-a2354aebdfc2">
<span class="eqno">(2)<a class="headerlink" href="#equation-fff28a12-188b-469f-8d74-a2354aebdfc2" title="Permalink to this equation">¶</a></span>\[\begin{align}
n(t) &amp;= s(t) - d(t)\\
&amp;= \mathcal{N}(\sigma=3, \mu=0)
\end{align}\]</div>
<p>[NOTE: we’ve hardcoded <code class="docutils literal notranslate"><span class="pre">sigma</span></code> here, but you could add in a prior on <code class="docutils literal notranslate"><span class="pre">sigma</span></code> as well]</p>
<p>Hence, we can write out the signal-model likliood <code class="docutils literal notranslate"><span class="pre">L(data|m,c)</span></code> as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-eab80652-fde2-4f8d-a992-2774126e33cf">
<span class="eqno">(3)<a class="headerlink" href="#equation-eab80652-fde2-4f8d-a992-2774126e33cf" title="Permalink to this equation">¶</a></span>\[\begin{align}
\mathcal{L}(\rm{data}|m,c) = \prod_j \rm{Normal}_{\rm{PDF}}(\left[d - s_j\right]; \mu=0,\sigma=3)
\end{align}\]</div>
<p>This type of <code class="docutils literal notranslate"><span class="pre">Gaussian</span></code> likelihoods has already been coded up in <code class="docutils literal notranslate"><span class="pre">bilby</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">GaussianLikelihood</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="n">signal_model</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s test if we can compute a likelihood and dont get a nan:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we need to provide the parameter to compute the likeliood for</span>
<span class="n">likelihood</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Log Likelihood (data| </span><span class="si">{</span><span class="n">likelihood</span><span class="o">.</span><span class="n">parameters</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">likelihood</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Log Likelihood (data| {&#39;m&#39;: 0, &#39;c&#39;: 0}) = -302.77
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="brute-force-posterior-computation">
<h2>Brute force posterior computation<a class="headerlink" href="#brute-force-posterior-computation" title="Permalink to this headline">¶</a></h2>
<p>We now have everything we need to compute our posterior!
In the first pass, lets compute the posterior over a grid of <code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code> values:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_grid_of_m_c</span><span class="p">(</span><span class="n">n_per_dim</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
    <span class="k">assert</span> <span class="s2">&quot;m&quot;</span> <span class="ow">in</span> <span class="n">prior</span> <span class="ow">and</span> <span class="s2">&quot;c&quot;</span> <span class="ow">in</span> <span class="n">prior</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
    <span class="n">m_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">m</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">m</span><span class="p">),</span> <span class="n">n_per_dim</span><span class="p">)</span>
    <span class="n">c_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">c</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">c</span><span class="p">),</span> <span class="n">n_per_dim</span><span class="p">)</span>
    <span class="n">m_grid</span><span class="p">,</span> <span class="n">c_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">m_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">c</span><span class="o">=</span><span class="n">c_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>


<span class="k">def</span> <span class="nf">plot_grid</span><span class="p">(</span><span class="n">m_c_grid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">m_c_grid</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">m_c_grid</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">12.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>
    

<span class="n">m_c_grid</span> <span class="o">=</span> <span class="n">get_grid_of_m_c</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">priors</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_grid</span><span class="p">(</span><span class="n">m_c_grid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_24_0.png" src="_images/workshop notebook_24_0.png" />
</div>
</div>
<p>Computing the prior, likelhood and posterior at each grid-point:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_brute_force_analysis</span><span class="p">(</span><span class="n">likelihood</span><span class="p">,</span> <span class="n">prior</span><span class="p">,</span> <span class="n">samples_list</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples_list</span><span class="p">)</span>
    <span class="n">log_likelihoods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">log_priors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">log_posteriors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> 
    <span class="n">log_evidence</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Brute force LnL computation&quot;</span><span class="p">):</span>
        <span class="n">likelihood</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">samples_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">log_likelihoods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">likelihood</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">()</span>
        <span class="n">log_priors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">ln_prob</span><span class="p">(</span><span class="n">samples_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">log_posteriors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_priors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">log_likelihoods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">log_evidence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logaddexp</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">log_posteriors</span><span class="o">+</span><span class="n">log_priors</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">samples</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">samples_list</span><span class="p">),</span>
        <span class="n">log_evidence</span><span class="o">=</span><span class="n">log_evidence</span><span class="p">,</span>
        <span class="n">likelihood</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_likelihoods</span><span class="p">),</span>
        <span class="n">prior</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_priors</span><span class="p">),</span>
        <span class="n">posterior</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_posteriors</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_grids_of_brute_result</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">xlims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_vals</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">7.5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">pi</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="n">like</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;prior&#39;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;posterior&#39;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;likelihood&#39;</span><span class="p">]</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">log_vals</span><span class="p">:</span>
        <span class="n">pi</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="n">like</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">post</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">like</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;log &quot;</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;$\pi(m,c)$&quot;</span><span class="p">)</span>
    <span class="n">plot_grid</span><span class="p">(</span><span class="n">m_c_grid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;$L(data|m,c)$&quot;</span><span class="p">)</span>
    <span class="n">plot_grid</span><span class="p">(</span><span class="n">m_c_grid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">like</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;$p(m,c|data)$&quot;</span><span class="p">)</span>
    <span class="n">plot_grid</span><span class="p">(</span><span class="n">m_c_grid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">post</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">xlims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="n">xlims</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
    
<span class="n">brute_result</span> <span class="o">=</span> <span class="n">run_brute_force_analysis</span><span class="p">(</span><span class="n">likelihood</span><span class="p">,</span> <span class="n">priors</span><span class="p">,</span> <span class="n">m_c_grid</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_grids_of_brute_result</span><span class="p">(</span><span class="n">brute_result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Brute force log evidence = </span><span class="si">{</span><span class="n">brute_result</span><span class="p">[</span><span class="s1">&#39;log_evidence&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "330157c0fd164c8aa188879f6d72e847", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Brute force log evidence = -250.17581140915786
</pre></div>
</div>
<img alt="_images/workshop notebook_26_2.png" src="_images/workshop notebook_26_2.png" />
</div>
</div>
<p>Looks like the answer is around
$$0&lt;m&lt;1, c\sim0$$</p>
<p>We can even compute the marginal posteriors:</p>
<div class="amsmath math notranslate nohighlight" id="equation-985af3b3-ae5d-4526-a62e-01f4a3339283">
<span class="eqno">(4)<a class="headerlink" href="#equation-985af3b3-ae5d-4526-a62e-01f4a3339283" title="Permalink to this equation">¶</a></span>\[\begin{align}
p(m|d)&amp;= \int_c p(m,c|d)\ dc\\
p(c|d)&amp;= \int_m p(m,c|d)\ dm
\end{align}\]</div>
<p>These will give us the estimated values for the model parameters</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">corner.core</span> <span class="kn">import</span> <span class="n">quantile</span>

<span class="k">def</span> <span class="nf">get_marginalised_posterior</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;samples&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">unique_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">parameter</span><span class="p">])</span>
    <span class="n">log_post</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">))</span>
    <span class="n">grid</span><span class="p">[</span><span class="s1">&#39;log_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;posterior&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_values</span><span class="p">):</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">grid</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">log_post</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logaddexp</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s2">&quot;log_post&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">unique_values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_post</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">p_of_x</span> <span class="o">=</span> <span class="n">get_marginalised_posterior</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">brute_result</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p_of_x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:purple&quot;</span><span class="p">)</span>
    <span class="n">low</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">up</span> <span class="o">=</span> <span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="n">p_of_x</span><span class="p">)</span>
    <span class="n">low</span><span class="p">,</span> <span class="n">up</span> <span class="o">=</span> <span class="n">mean</span><span class="o">-</span><span class="n">low</span><span class="p">,</span> <span class="n">up</span><span class="o">-</span><span class="n">mean</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;${{</span><span class="si">{0:.2f}</span><span class="s2">}}_{{-</span><span class="si">{1:.2f}</span><span class="s2">}}^{{+</span><span class="si">{2:.2f}</span><span class="s2">}}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_29_0.png" src="_images/workshop notebook_29_0.png" />
</div>
</div>
<p>Lets also plot the posterior predictive check:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_model_on_data</span><span class="p">(</span>
    <span class="n">m_c_grid</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">brute_result</span><span class="p">[</span><span class="s1">&#39;posterior&#39;</span><span class="p">]),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:purple&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_31_0.png" src="_images/workshop notebook_31_0.png" />
</div>
</div>
</div>
<div class="section" id="sampling-from-the-posterior">
<h2>Sampling from the posterior<a class="headerlink" href="#sampling-from-the-posterior" title="Permalink to this headline">¶</a></h2>
<p>There are some drawbacks from brute-force posterior estimation.</p>
<p>What happens when the number of parameters increases to 15?</p>
<p>Drawing samples from the posterior and trying to estimate the likelihood may be a cheaper approach.</p>
<p>Below is some code to demonstrate how we can use bilby + a <code class="docutils literal notranslate"><span class="pre">nested</span></code> sampler “dynesty” to do this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sampler_run</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">run_sampler</span><span class="p">(</span>
        <span class="n">likelihood</span><span class="o">=</span><span class="n">likelihood</span><span class="p">,</span>
        <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span>
        <span class="n">sampler</span><span class="o">=</span><span class="s2">&quot;dynesty&quot;</span><span class="p">,</span>
        <span class="n">nlive</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">sample</span><span class="o">=</span><span class="s2">&quot;unif&quot;</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;linear_regression&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">sampler_result</span> <span class="o">=</span> <span class="n">sampler_run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>03:40 bilby INFO    : Running for label &#39;linear_regression&#39;, output will be saved to &#39;outdir&#39;
03:40 bilby INFO    : Analysis priors:
03:40 bilby INFO    : m=TruncatedNormal(mu=0, sigma=1, minimum=0, maximum=3, name=&#39;m&#39;, latex_label=&#39;m&#39;, unit=None, boundary=None)
03:40 bilby INFO    : c=Uniform(minimum=-5, maximum=5, name=&#39;c&#39;, latex_label=&#39;c&#39;, unit=None, boundary=None)
03:40 bilby INFO    : Analysis likelihood class: &lt;class &#39;bilby.core.likelihood.GaussianLikelihood&#39;&gt;
03:40 bilby INFO    : Analysis likelihood noise evidence: nan
03:40 bilby INFO    : Single likelihood evaluation took 1.692e-04 s
03:40 bilby INFO    : Using sampler Dynesty with kwargs {&#39;nlive&#39;: 500, &#39;bound&#39;: &#39;multi&#39;, &#39;sample&#39;: &#39;unif&#39;, &#39;periodic&#39;: None, &#39;reflective&#39;: None, &#39;update_interval&#39;: None, &#39;first_update&#39;: None, &#39;npdim&#39;: None, &#39;rstate&#39;: None, &#39;queue_size&#39;: 1, &#39;pool&#39;: None, &#39;use_pool&#39;: None, &#39;live_points&#39;: None, &#39;logl_args&#39;: None, &#39;logl_kwargs&#39;: None, &#39;ptform_args&#39;: None, &#39;ptform_kwargs&#39;: None, &#39;gradient&#39;: None, &#39;grad_args&#39;: None, &#39;grad_kwargs&#39;: None, &#39;compute_jac&#39;: False, &#39;enlarge&#39;: None, &#39;bootstrap&#39;: None, &#39;walks&#39;: 100, &#39;facc&#39;: 0.2, &#39;slices&#39;: None, &#39;fmove&#39;: 0.9, &#39;max_move&#39;: 100, &#39;update_func&#39;: None, &#39;ncdim&#39;: None, &#39;blob&#39;: False, &#39;save_history&#39;: False, &#39;history_filename&#39;: None, &#39;maxiter&#39;: None, &#39;maxcall&#39;: None, &#39;dlogz&#39;: 0.1, &#39;logl_max&#39;: inf, &#39;n_effective&#39;: None, &#39;add_live&#39;: True, &#39;print_progress&#39;: True, &#39;print_func&#39;: &lt;bound method Dynesty._print_func of &lt;bilby.core.sampler.dynesty.Dynesty object at 0x139c990d0&gt;&gt;, &#39;save_bounds&#39;: False, &#39;checkpoint_file&#39;: None, &#39;checkpoint_every&#39;: 60, &#39;resume&#39;: False}
03:40 bilby INFO    : Checkpoint every check_point_delta_t = 600s
03:40 bilby INFO    : Using dynesty version 2.1.0
03:40 bilby INFO    : Resume file outdir/linear_regression_resume.pickle does not exist.
03:40 bilby INFO    : Generating initial points from the prior
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "b51a92392c104074a94f33bbc22e4a61", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>03:40 bilby INFO    : Written checkpoint file outdir/linear_regression_resume.pickle
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>03:40 bilby INFO    : Sampling time: 0:00:09.677080
03:40 bilby INFO    : Summary of results:
nsamples: 3914
ln_noise_evidence:    nan
ln_evidence: -253.372 +/-  0.106
ln_bayes_factor:    nan +/-  0.106
</pre></div>
</div>
</div>
</div>
<p>Now we can make some plots.</p>
<p>First, lets plot the <code class="docutils literal notranslate"><span class="pre">corner</span></code> plot, and overplot the prior (in green) in the 1D distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">sampler_result</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span><span class="n">priors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_35_0.png" src="_images/workshop notebook_35_0.png" />
</div>
</div>
<p>Now lets check how well we have done (comparing against the true value):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">truths</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_model_on_data</span><span class="p">(</span><span class="n">sampler_result</span><span class="o">.</span><span class="n">posterior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">signal_model</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">truths</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">truths</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:orange&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_37_0.png" src="_images/workshop notebook_37_0.png" />
</div>
</div>
<p>Lets finally compare the brute-force results and the nested-sampling results:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">overplot_sampler_and_brute_force</span><span class="p">(</span><span class="n">sampler_result</span><span class="p">,</span> <span class="n">brute_result</span><span class="p">,</span> <span class="n">truths</span><span class="p">):</span>
    <span class="n">truths</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">truths</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">truths</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">])</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">sampler_result</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">truths</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># overplot the grid estimates</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span>
    
    <span class="c1"># add marginals </span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">axi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">axi</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">p_of_x</span> <span class="o">=</span> <span class="n">get_marginalised_posterior</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">brute_result</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p_of_x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:purple&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.15</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p_of_x</span><span class="p">))</span>
        
    
    <span class="n">samples_grid</span> <span class="o">=</span> <span class="n">brute_result</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span>
    <span class="n">n_cells</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples_grid</span><span class="p">)))</span>
    <span class="n">m_grid</span> <span class="o">=</span> <span class="n">samples_grid</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">)</span>
    <span class="n">c_grid</span> <span class="o">=</span> <span class="n">samples_grid</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">)</span>
    <span class="n">posterior_grid</span> <span class="o">=</span> <span class="n">brute_result</span><span class="p">[</span><span class="s1">&#39;posterior&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
        <span class="n">m_grid</span><span class="p">,</span> <span class="n">c_grid</span><span class="p">,</span> <span class="n">posterior_grid</span><span class="p">,</span> 
        <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">posterior_grid</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Purples&quot;</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sampler&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Brute-Force&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:purple&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:orange&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Brute force ln_evidence: </span><span class="si">{</span><span class="n">brute_result</span><span class="p">[</span><span class="s1">&#39;log_evidence&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sampler ln_evidence: </span><span class="si">{</span><span class="n">sampler_result</span><span class="o">.</span><span class="n">log_evidence</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">overplot_sampler_and_brute_force</span><span class="p">(</span><span class="n">sampler_result</span><span class="p">,</span> <span class="n">brute_result</span><span class="p">,</span> <span class="n">truths</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Brute force ln_evidence: -250.17581140915786
Sampler ln_evidence: -253.37187972013103
</pre></div>
</div>
<img alt="_images/workshop notebook_39_1.png" src="_images/workshop notebook_39_1.png" />
</div>
</div>
<p>Both sets of results match up quite well! Even the log-evidences are comparable.</p>
<p>Lets move on to GW signals!</p>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="cbc-gw-signal-model">
<h1>CBC GW  Signal Model<a class="headerlink" href="#cbc-gw-signal-model" title="Permalink to this headline">¶</a></h1>
<p>The GW from compact binary coalescence (CBC) systems can be modeled using the following parameters:</p>
<ul class="simple">
<li><p>2 mass parameters (eg m1, m2)</p></li>
<li><p>6 spin parameters (eg s1x, s1y, s1z, …)</p></li>
<li><p>2 tidal deformation parameters (for neutron stars, lambda1, lambda2)</p></li>
<li><p>2 orbital eccentricity parameters (e, arg of periastron)</p></li>
<li><p>7 extrinsic parameters (distance, sky-loc, timing, phase)</p></li>
</ul>
<p>Some of these are shown here:</p>
<div>
<img src="https://gcdnb.pbrd.co/images/EfwMgftuS4L5.png?o=1" width="350"/>
</div>
<p>Additionally, there are quite a few re-parameterisations of these.</p>
<p>For example, instead of the component masses $m_1, m_2$, one could also use the</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mass_ratio</span></code>: <code class="docutils literal notranslate"><span class="pre">q=m_2/m_1</span></code> where <code class="docutils literal notranslate"><span class="pre">m_1&gt;m_2</span></code>, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chirp_mass</span></code>:</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-3ae0860f-463a-44d3-9a1f-73fde7bb2522">
<span class="eqno">(5)<a class="headerlink" href="#equation-3ae0860f-463a-44d3-9a1f-73fde7bb2522" title="Permalink to this equation">¶</a></span>\[\begin{align}
\mathcal{M} = \frac{(m_1 m_2)^{3/5}}{(m_1 + m_2)^{1/5}}
\end{align}\]</div>
<p>Similarly, we can use parameterize the dimensionless spins with the following 6 parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">chi_i</span></code> or $a_i$ : the spin magnitude (<code class="docutils literal notranslate"><span class="pre">0&lt;a_i&lt;1</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">theta_i</span></code> or <code class="docutils literal notranslate"><span class="pre">tilt_i</span></code>: the angle of the component binary wrt the <code class="docutils literal notranslate"><span class="pre">z</span></code> axis (along the orbital axis)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">phi_12</span></code>: the difference between the component spins projected on the <code class="docutils literal notranslate"><span class="pre">xy</span></code> plane (along the orbital plane)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">theta_jl</span></code>: the angle between the orbital angular momentum <code class="docutils literal notranslate"><span class="pre">L</span></code> vector and the total angular momentum vector <code class="docutils literal notranslate"><span class="pre">J</span></code>.</p></li>
</ul>
<p>Lets go over all the parameters in more detail:</p>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">Intrinsic parameters</label><div class="tab-content docutils">
<p><strong>INTRINSIC PARAMETERS</strong></p>
<ul class="simple">
<li><p>Mass: 2D</p>
<ul>
<li><p>Usually uniform in two mass parameters</p></li>
<li><p>Component masses widely used (<code class="docutils literal notranslate"><span class="pre">m_1,</span> <span class="pre">m_2</span></code>)</p></li>
<li><p>“Chirp” mass and mass ratio a more convenient basis</p></li>
<li><p>Usually specified in the “detector-frame”, redshifted relative to true “source-frame” mass</p></li>
</ul>
</li>
<li><p>Dimensionless Spin: 6D</p>
<ul>
<li><p>Fully precessing (see animation)</p>
<ul>
<li><p>usually uniform in magnitude and isotropic in orientation</p></li>
</ul>
</li>
<li><p>Only spin aligned with orbital angular momentum - set planar spin components to zero</p>
<ul>
<li><p>same prior on aligned spin as in the precessing case</p></li>
<li><p>uniform in aligned spin</p></li>
</ul>
</li>
<li><p>Zero spin</p>
<ul>
<li><p>all spin components are zero</p></li>
<li><p>smaller space to sample</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Orbital eccentricity: 1D/2D</p>
<ul>
<li><p>Often ignored (eccentricity and argument of periastron)</p></li>
</ul>
</li>
<li><p>Matter effects (for neutron stars): 2D</p>
<ul>
<li><p>Two tidal deformability parameters <code class="docutils literal notranslate"><span class="pre">Lambda_i</span></code></p></li>
<li><p>Parameters describing the neutron star equation of state (EoS)</p>
<ul>
<li><p>Variable number</p></li>
<li><p>Zero-dimensional for fixed equation of state</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">Extrinsic parameters </label><div class="tab-content docutils">
<p><strong>EXTRINSIC PARAMETERS</strong></p>
<ul class="simple">
<li><p>Location: 3D</p>
<ul>
<li><p>ra, dec, distance</p></li>
<li><p>Usually isotropic over the sky</p></li>
<li><p>Distance prior uniform in volume</p>
<ul>
<li><p>Should include cosmological effects</p></li>
</ul>
</li>
<li><p>Use host galaxy location, e.g., GW170817, S190521g(?)</p></li>
</ul>
</li>
<li><p>Orientation: 4D</p>
<ul>
<li><p>Three Euler angles (phase, inclination, polarisation)</p>
<ul>
<li><p>Assumed to be distributed isotropically</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Merger time</p>
<ul>
<li><p>Uniform based on expected uncertainty in trigger time</p></li>
<li><p>Typically ~ 0.1s</p></li>
</ul>
</li>
</ul>
</div>
</div>
<p>Note: increasing the spin in the x-y components can lead to precession.</p>
<div>
<img src="https://media4.giphy.com/media/NF76iRgEerkx0qrsD0/giphy.gif?cid=790b76113d85f36207d50f4d1f42feead29a3c4cb8f2f1a6&rid=giphy.gif&ct=g" width="350"/>
</div>
<p>Such a highly precessing system may be found in globular clusters/AGNs.</p>
<p>Lets plot our own waveform:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bilby</span>
<span class="kn">from</span> <span class="nn">bilby.gw.conversion</span> <span class="kn">import</span> <span class="n">chirp_mass_and_mass_ratio_to_component_masses</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">bilby_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;bilby&quot;</span><span class="p">)</span>
<span class="n">bilby_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">make_waveform_generator</span><span class="p">(</span><span class="n">approximant</span><span class="o">=</span><span class="s2">&quot;IMRPhenomPv2&quot;</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
                            <span class="n">frequency_domain_source_model</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">lal_binary_black_hole</span><span class="p">,</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a waveform generator&quot;&quot;&quot;</span>
    <span class="n">generator_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
        <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">sampling_frequency</span><span class="p">,</span>
        <span class="n">frequency_domain_source_model</span><span class="o">=</span><span class="n">frequency_domain_source_model</span><span class="p">,</span>
        <span class="n">waveform_arguments</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">waveform_approximant</span><span class="o">=</span><span class="n">approximant</span><span class="p">,</span>
            <span class="n">reference_frequency</span><span class="o">=</span><span class="mf">20.</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">WaveformGenerator</span><span class="p">(</span><span class="o">**</span><span class="n">generator_args</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">compute_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="n">signal_parameters</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;Compute the waveform&quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="c1"># two mass parameters</span>
        <span class="n">mass_1</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">mass_2</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="c1"># 6 spin parameters</span>
        <span class="n">a_1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">a_2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">tilt_1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tilt_2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">phi_jl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">phi_12</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="c1"># 2 tidal deformation parameters (for NS)</span>
        <span class="n">lambda_1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lambda_2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="c1"># 7 extrinsic parameters (skyloc, timing, phase, etc)</span>
        <span class="n">luminosity_distance</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">theta_jn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ra</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">psi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">geocent_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">signal_parameters</span><span class="p">)</span>
    <span class="n">bilby_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;computing waveform with parameters: </span><span class="si">{</span><span class="n">parameters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">time_domain_strain</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">time_array</span>
    <span class="n">approximant</span> <span class="o">=</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">waveform_arguments</span><span class="p">[</span><span class="s2">&quot;waveform_approximant&quot;</span><span class="p">]</span>
    <span class="n">delta_t</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">sampling_frequency</span>

    <span class="k">if</span> <span class="s2">&quot;IMR&quot;</span> <span class="ow">in</span> <span class="n">approximant</span><span class="p">:</span>
        <span class="c1"># IMR templates the zero of time is at max amplitude (merger)</span>
        <span class="c1"># thus we roll the waveform back a bit</span>
        <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">h</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">pol</span><span class="p">],</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">pol</span><span class="p">])</span> <span class="o">//</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">h_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;plus&#39;</span><span class="p">]))</span>
    <span class="n">h_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">h_phase</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">delta_t</span><span class="p">)</span>
    <span class="c1"># nan the freqs after the merger</span>
    <span class="n">h_freq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">h_freq</span><span class="p">):]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">h_freq</span><span class="p">,</span> <span class="n">t</span>


<span class="k">def</span> <span class="nf">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="n">signal_parameters</span><span class="o">=</span><span class="p">{},</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">polarisation</span><span class="o">=</span><span class="s1">&#39;plus&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">):</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">h_freq</span><span class="p">,</span> <span class="n">h_time</span> <span class="o">=</span> <span class="n">compute_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="n">signal_parameters</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">polarisation</span> <span class="o">==</span><span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h_time</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;plus&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;plus&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h_time</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h_time</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="n">polarisation</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Strain&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">h_time</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">h_time</span><span class="p">))</span>
    <span class="c1"># remove whitespace between subplots</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waveform_generator</span> <span class="o">=</span> <span class="n">make_waveform_generator</span><span class="p">(</span><span class="n">approximant</span><span class="o">=</span><span class="s2">&quot;IMRPhenomPv2&quot;</span><span class="p">)</span>
<span class="n">bilby_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mass_1</span><span class="o">=</span><span class="mf">20.</span><span class="p">,</span> <span class="n">mass_2</span><span class="o">=</span><span class="mf">25.</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">polarisation</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>03:40 bilby INFO    : computing waveform with parameters: {&#39;mass_1&#39;: 20.0, &#39;mass_2&#39;: 25.0, &#39;a_1&#39;: 0.0, &#39;a_2&#39;: 0.0, &#39;tilt_1&#39;: 0, &#39;tilt_2&#39;: 0, &#39;phi_jl&#39;: 0, &#39;phi_12&#39;: 0, &#39;lambda_1&#39;: 0, &#39;lambda_2&#39;: 0, &#39;luminosity_distance&#39;: 1000, &#39;theta_jn&#39;: 0, &#39;ra&#39;: 0, &#39;dec&#39;: 0, &#39;psi&#39;: 0.5, &#39;phase&#39;: 0, &#39;geocent_time&#39;: 0}
</pre></div>
</div>
<img alt="_images/workshop notebook_46_1.png" src="_images/workshop notebook_46_1.png" />
</div>
</div>
<p>Q: What happens if we increase chirp-mass?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bilby_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span> <span class="c1"># turn off logging</span>
<span class="k">for</span> <span class="n">mc</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
    <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">chirp_mass_and_mass_ratio_to_component_masses</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">signal_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mass_1</span><span class="o">=</span><span class="n">m1</span><span class="p">,</span> <span class="n">mass_2</span><span class="o">=</span><span class="n">m2</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="n">signal_parameters</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2"> = &quot;</span><span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;M_{\odot}$&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> 
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_48_0.png" src="_images/workshop notebook_48_0.png" />
<img alt="_images/workshop notebook_48_1.png" src="_images/workshop notebook_48_1.png" />
<img alt="_images/workshop notebook_48_2.png" src="_images/workshop notebook_48_2.png" />
</div>
</div>
<p>Playing around with some interactive plots can also help build some intuition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">interact_manual</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>

<span class="nd">@interact</span><span class="p">(</span><span class="n">a_1</span><span class="o">=</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">interact_a1</span><span class="p">(</span><span class="n">a_1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a_1</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">a_2</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;a_1=0.01&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a_1</span><span class="o">=</span><span class="n">a_1</span><span class="p">,</span> <span class="n">a_2</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;a_1=</span><span class="si">{</span><span class="n">a_1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> 
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "489e1758b39f4f73b70c70ceffdc55d4", "version_major": 2, "version_minor": 0}
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@interact</span><span class="p">(</span><span class="n">dist</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">interact_dist</span><span class="p">(</span><span class="n">dist</span><span class="o">=</span><span class="mi">2000</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">luminosity_distance</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;d=1000 Mpc&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">luminosity_distance</span><span class="o">=</span><span class="n">dist</span><span class="p">),</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;d=</span><span class="si">{</span><span class="n">dist</span><span class="si">}</span><span class="s2"> Mpc&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">7e-22</span><span class="p">,</span><span class="mf">7e-22</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "b52427b30ec74c19b78c3c14ec331493", "version_major": 2, "version_minor": 0}
</script></div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="cbc-parameter-estimation">
<h1>CBC Parameter Estimation<a class="headerlink" href="#cbc-parameter-estimation" title="Permalink to this headline">¶</a></h1>
<p>Finally, we get to actual parameter estimation for gravitational waves!</p>
<div class="section" id="simulate-a-signal">
<h2>Simulate a signal<a class="headerlink" href="#simulate-a-signal" title="Permalink to this headline">¶</a></h2>
<p>We start by first simulating a signal (using the same code as the previous section for waveform generation)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bilby</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">bilby_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;bilby&quot;</span><span class="p">)</span>
<span class="n">bilby_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1"># Simulate signal</span>
<span class="n">duration</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="p">,</span> <span class="n">min_freq</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">1024.</span><span class="p">,</span> <span class="mi">20</span>
<span class="n">injection_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">mass_1</span><span class="o">=</span><span class="mf">36.0</span><span class="p">,</span> <span class="n">mass_2</span><span class="o">=</span><span class="mf">29.0</span><span class="p">,</span>  <span class="c1"># 2 mass parameters</span>
    <span class="n">a_1</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">a_2</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">tilt_1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">tilt_2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_12</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_jl</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># 6 spin parameters</span>
    <span class="n">ra</span><span class="o">=</span><span class="mf">1.375</span><span class="p">,</span> <span class="n">dec</span><span class="o">=-</span><span class="mf">1.2108</span><span class="p">,</span> <span class="n">luminosity_distance</span><span class="o">=</span><span class="mf">2000.0</span><span class="p">,</span> <span class="n">theta_jn</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># 7 extrinsic parameters</span>
    <span class="n">psi</span><span class="o">=</span><span class="mf">2.659</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span>
    <span class="n">geocent_time</span><span class="o">=</span><span class="mf">1126259642.413</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">inj_m1</span><span class="p">,</span> <span class="n">inj_m2</span> <span class="o">=</span> <span class="n">injection_parameters</span><span class="p">[</span><span class="s1">&#39;mass_1&#39;</span><span class="p">],</span> <span class="n">injection_parameters</span><span class="p">[</span><span class="s1">&#39;mass_2&#39;</span><span class="p">]</span>
<span class="n">inj_chirp_mass</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">component_masses_to_chirp_mass</span><span class="p">(</span><span class="n">inj_m1</span><span class="p">,</span> <span class="n">inj_m2</span><span class="p">)</span>
<span class="n">inj_q</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">component_masses_to_mass_ratio</span><span class="p">(</span><span class="n">inj_m1</span><span class="p">,</span> <span class="n">inj_m2</span><span class="p">)</span>

<span class="n">waveform_generator</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">WaveformGenerator</span><span class="p">(</span>
    <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
    <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">sampling_freq</span><span class="p">,</span>
    <span class="n">frequency_domain_source_model</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">lal_binary_black_hole</span><span class="p">,</span>
    <span class="n">parameter_conversion</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">convert_to_lal_binary_black_hole_parameters</span><span class="p">,</span>
    <span class="n">waveform_arguments</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">waveform_approximant</span><span class="o">=</span><span class="s2">&quot;IMRPhenomD&quot;</span><span class="p">,</span>
        <span class="n">reference_frequency</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
        <span class="n">minimum_frequency</span><span class="o">=</span><span class="n">min_freq</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>03:40 bilby INFO    : Waveform generator initiated with
  frequency_domain_source_model: bilby.gw.source.lal_binary_black_hole
  time_domain_source_model: None
  parameter_conversion: bilby.gw.conversion.convert_to_lal_binary_black_hole_parameters
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="n">injection_parameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>03:40 bilby INFO    : computing waveform with parameters: {&#39;mass_1&#39;: 36.0, &#39;mass_2&#39;: 29.0, &#39;a_1&#39;: 0.1, &#39;a_2&#39;: 0.1, &#39;tilt_1&#39;: 0.0, &#39;tilt_2&#39;: 0.0, &#39;phi_jl&#39;: 0.0, &#39;phi_12&#39;: 0.0, &#39;lambda_1&#39;: 0, &#39;lambda_2&#39;: 0, &#39;luminosity_distance&#39;: 2000.0, &#39;theta_jn&#39;: 0.0, &#39;ra&#39;: 1.375, &#39;dec&#39;: -1.2108, &#39;psi&#39;: 2.659, &#39;phase&#39;: 1.3, &#39;geocent_time&#39;: 1126259642.413}
</pre></div>
</div>
<img alt="_images/workshop notebook_54_1.png" src="_images/workshop notebook_54_1.png" />
</div>
</div>
</div>
<div class="section" id="inject-the-signal-into-an-interferometer-s-data-stream">
<h2>Inject the signal into an interferometer’s data stream<a class="headerlink" href="#inject-the-signal-into-an-interferometer-s-data-stream" title="Permalink to this headline">¶</a></h2>
<p>We can now simulate some detector noise and inject this signal into the detector-noise</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inject the signal into 1 detectors LIGO-Hanford (H1) at design sensitivity</span>
<span class="n">ifos</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">InterferometerList</span><span class="p">([</span><span class="s2">&quot;H1&quot;</span><span class="p">])</span>
<span class="n">ifos</span><span class="o">.</span><span class="n">set_strain_data_from_power_spectral_densities</span><span class="p">(</span>
    <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">sampling_freq</span><span class="p">,</span>
    <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
    <span class="n">start_time</span><span class="o">=</span><span class="n">injection_parameters</span><span class="p">[</span><span class="s2">&quot;geocent_time&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ifos</span><span class="o">.</span><span class="n">inject_signal</span><span class="p">(</span>
    <span class="n">waveform_generator</span><span class="o">=</span><span class="n">waveform_generator</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">injection_parameters</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">interferometer</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">:</span>
    <span class="n">analysis_data</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">frequency_domain_strain</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">frequency_array</span><span class="p">,</span> <span class="n">analysis_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:orange&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">frequency_array</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">amplitude_spectral_density_array</span><span class="p">),</span>
               <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ASD (estimated noise)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:orange&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">minimum_frequency</span><span class="p">,</span> <span class="n">interferometer</span><span class="o">.</span><span class="n">maximum_frequency</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency [Hz]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Strain [strain/$\sqrt{\rm Hz}$]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>03:40 bilby INFO    : Injected signal in H1:
03:40 bilby INFO    :   optimal SNR = 12.18
03:40 bilby INFO    :   matched filter SNR = 11.37-1.43j
03:40 bilby INFO    :   mass_1 = 36.0
03:40 bilby INFO    :   mass_2 = 29.0
03:40 bilby INFO    :   a_1 = 0.1
03:40 bilby INFO    :   a_2 = 0.1
03:40 bilby INFO    :   tilt_1 = 0.0
03:40 bilby INFO    :   tilt_2 = 0.0
03:40 bilby INFO    :   phi_12 = 0.0
03:40 bilby INFO    :   phi_jl = 0.0
03:40 bilby INFO    :   ra = 1.375
03:40 bilby INFO    :   dec = -1.2108
03:40 bilby INFO    :   luminosity_distance = 2000.0
03:40 bilby INFO    :   theta_jn = 0.0
03:40 bilby INFO    :   psi = 2.659
03:40 bilby INFO    :   phase = 1.3
03:40 bilby INFO    :   geocent_time = 1126259642.413
</pre></div>
</div>
<img alt="_images/workshop notebook_56_1.png" src="_images/workshop notebook_56_1.png" />
</div>
</div>
<div class="section" id="notes-about-noise">
<h3>Notes about noise:<a class="headerlink" href="#notes-about-noise" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Lots of short duration glitches</p></li>
<li><p>The main contribution to LIGO/Virgo/KAGRA data is coloured Gaussian noise.</p></li>
<li><p>Constant frequency “lines”</p></li>
</ul>
<p>The Gaussian noise is described by the noise amplitude (power) spectral density, ASD (PSD).</p>
<p>Most conveniently described in the frequency domain using a <a class="reference external" href="https://en.wikipedia.org/wiki/Complex_normal_distribution#Circularly-symmetric_normal_distribution">circularly-symmetric complex normal distribution</a>.</p>
<div class="section" id="power-ampitude-spectral-density-generation-psd-asd">
<h4>Power/Ampitude-spectral-density generation (PSD/ASD)<a class="headerlink" href="#power-ampitude-spectral-density-generation-psd-asd" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Average over data (normally do this)</p>
<ul>
<li><p>Divide a long chunk of data and average the power in each chunk</p></li>
<li><p>Assumes the PSD does not vary with time</p></li>
<li><p>Assumes data are Gaussian over the full time stretch</p></li>
<li><p>Has well defined statistical uncertainty</p></li>
</ul>
</li>
<li><p>Fit a parameterised model to the data (eg using instrumental info from Dan Brown’s talk)</p>
<ul>
<li><p>E.g., <code class="docutils literal notranslate"><span class="pre">BayesLine</span></code></p></li>
<li><p>Describing the PSD requires lots of parameters</p></li>
<li><p>Estimating all these parameters is difficult and computationally expensive</p></li>
<li><p>Especially expensive marginalise over the uncertainty in the model while fitting CBC signal models</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="glitches">
<h4>Glitches<a class="headerlink" href="#glitches" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Short term, terrestrial, non-Gaussian transients</p></li>
<li><p>Can bias parameter estimation if overlapping signal</p></li>
<li><p>Can bias PSD estimation
To mitigate:</p></li>
<li><p>Zero out data containing glitch, “gating”</p>
<ul>
<li><p>Also potentially removes signal</p></li>
<li><p>Can bias PSD estimation if care is not taken</p></li>
</ul>
</li>
<li><p>Fit a parameterised model to remove the glitch</p>
<ul>
<li><p>E.g., <code class="docutils literal notranslate"><span class="pre">BayesWave</span></code></p></li>
<li><p>Describing the PSD requires lots of parameters</p></li>
<li><p>Estimating all these parameters is difficult and computationally expensive</p></li>
<li><p>Especially expensive marginalise over the uncertainty in the model while fitting CBC signal models</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="lines">
<h4>Lines<a class="headerlink" href="#lines" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Data at specific frequencies are persistently non-Gaussian and non-stationary</p></li>
<li><p>Large amplitude can cause spectral leakage</p>
<ul>
<li><p>Need to apply a window</p></li>
</ul>
</li>
<li><p>Many have known causes</p>
<ul>
<li><p>Suspension “violin” modes</p></li>
<li><p>Calibration lines</p></li>
<li><p>Mains power lines</p></li>
<li><p>…</p></li>
</ul>
</li>
<li><p>Some can be subtracted (“cleaned”) from the data stream</p></li>
<li><p>Can be correlated between detectors</p></li>
<li><p>Commonly not analysed when searching for long-duration signals</p></li>
<li><p>Included in compact binary coalescence parameter estimation (for now…)</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="create-priors-for-analysis">
<h2>Create priors for analysis<a class="headerlink" href="#create-priors-for-analysis" title="Permalink to this headline">¶</a></h2>
<p>Since sampling all parameters will take a long time, we set delta-functions to all but one mass parameter (chirp-mass).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We sample in chirp-mass and mass-ratio, however--these are quite un-astrophysical priors</span>
<span class="c1"># but in post-processing convert to uniform-in-component masses </span>
<span class="n">priors</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">BBHPriorDict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
    <span class="s2">&quot;a_1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;a_2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tilt_1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tilt_2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phi_12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phi_jl&quot;</span><span class="p">,</span>
    <span class="s2">&quot;psi&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ra&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dec&quot;</span><span class="p">,</span>
    <span class="s2">&quot;geocent_time&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phase&quot;</span><span class="p">,</span>
    <span class="s2">&quot;theta_jn&quot;</span><span class="p">,</span>
    <span class="s2">&quot;luminosity_distance&quot;</span><span class="p">,</span>
<span class="p">]:</span>
    <span class="n">priors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">injection_parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="n">priors</span><span class="p">[</span><span class="s2">&quot;mass_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inj_q</span>
<span class="n">priors</span><span class="p">[</span><span class="s2">&quot;chirp_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">UniformInComponentsChirpMass</span><span class="p">(</span>
    <span class="n">minimum</span><span class="o">=</span><span class="n">inj_chirp_mass</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">maximum</span><span class="o">=</span><span class="n">inj_chirp_mass</span> <span class="o">+</span> <span class="mi">5</span>
<span class="p">)</span>

<span class="c1"># Perform a check that the prior does not extend to a parameter space longer than the data</span>
<span class="n">priors</span><span class="o">.</span><span class="n">validate_prior</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">min_freq</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>03:40 bilby INFO    : No prior given, using default BBH priors in /Users/avaj0001/Documents/projects/deep_gw_pe_followup/venv/lib/python3.9/site-packages/bilby/gw/prior_files/precessing_spins_bbh.prior.
</pre></div>
</div>
</div>
</div>
<p>Making some plots of the priors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc</span> <span class="o">=</span> <span class="n">priors</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)[</span><span class="s1">&#39;chirp_mass&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Chirp Mass &quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$M_{\odot}$&quot;</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_61_0.png" src="_images/workshop notebook_61_0.png" />
</div>
</div>
</div>
<div class="section" id="create-the-likelihood-to-use-for-analysis">
<h2>Create the likelihood to use for analysis<a class="headerlink" href="#create-the-likelihood-to-use-for-analysis" title="Permalink to this headline">¶</a></h2>
<p>Similar to the line-signal in Gaussian noise case, we assume that the GW signal is embedded in some Gaussian noise. We also assume that the noise is stationary.</p>
<p>With these asumptions, we can use the <a class="reference external" href="https://en.wikipedia.org/wiki/Whittle_likelihood">Whittle likelihood</a>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-735fe4cf-5775-4ca3-8cec-a6609781d9d0">
<span class="eqno">(6)<a class="headerlink" href="#equation-735fe4cf-5775-4ca3-8cec-a6609781d9d0" title="Permalink to this equation">¶</a></span>\[\begin{align}
\mathcal{L}(d | \theta) = \prod^{\rm{H, L, V}}_{i}\ \prod^{20-2048Hz}_{j} \frac{1}{2 \pi\  \rm{PSD}_{i,j} } \exp\left( -\frac{|\tilde{d}_{i,j} - \tilde{h}_{i,j}(\theta)|^2}{2\ \rm{PSD}_{i,j} } \right).
\end{align}\]</div>
<p>Here:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">d</span></code> is the frequency-domain strain data,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">h</span></code> is the template waveform</p></li>
</ul>
<p>This can be instantiated in bilby like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the IFOs contain the data and PSD for each detector</span>
<span class="c1"># the waveform generator can generate differnt h(t)</span>
<span class="n">likelihood</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">GravitationalWaveTransient</span><span class="p">(</span>
    <span class="n">interferometers</span><span class="o">=</span><span class="n">ifos</span><span class="p">,</span> 
    <span class="n">waveform_generator</span><span class="o">=</span><span class="n">waveform_generator</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="run-inference">
<h2>Run inference<a class="headerlink" href="#run-inference" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">RE_RUN_SLOW_CELLS</span><span class="p">:</span>
    <span class="c1"># Run sampler.  In this case we&#39;re going to use the `dynesty` sampler</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">run_sampler</span><span class="p">(</span>
        <span class="n">likelihood</span><span class="o">=</span><span class="n">likelihood</span><span class="p">,</span>
        <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span>
        <span class="n">sampler</span><span class="o">=</span><span class="s2">&quot;dynesty&quot;</span><span class="p">,</span>
        <span class="n">npoints</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
        <span class="n">nlive</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">walks</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
        <span class="n">dlogz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">injection_parameters</span><span class="o">=</span><span class="n">injection_parameters</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;injection&quot;</span><span class="p">,</span>
        <span class="n">conversion_function</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">generate_all_bbh_parameters</span><span class="p">,</span>
        <span class="n">result_class</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">CBCResult</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping sampling...&quot;</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s2">/injection_result.json&quot;</span>
    <span class="n">download</span><span class="p">(</span><span class="n">INJECTION_URL</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">CBCResult</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded result!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Skipping sampling...
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "6556e326d2dc437f81775aaf7c5c5d36", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loaded result!
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="make-some-plots">
<h2>Make some plots<a class="headerlink" href="#make-some-plots" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mass_1&quot;</span><span class="p">,</span> <span class="s2">&quot;mass_2&quot;</span><span class="p">],</span> <span class="n">truths</span><span class="o">=</span><span class="p">[</span><span class="n">inj_m1</span><span class="p">,</span> <span class="n">inj_m2</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">interferometer</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">:</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot_interferometer_waveform_posterior</span><span class="p">(</span>
        <span class="n">interferometer</span><span class="o">=</span><span class="n">interferometer</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>03:40 bilby INFO    : Generating waveform figure for H1
03:40 bilby INFO    : Waveform generator initiated with
  frequency_domain_source_model: bilby.gw.source.lal_binary_black_hole
  time_domain_source_model: None
  parameter_conversion: bilby.gw.conversion.convert_to_lal_binary_black_hole_parameters
</pre></div>
</div>
<img alt="_images/workshop notebook_67_1.png" src="_images/workshop notebook_67_1.png" />
<img alt="_images/workshop notebook_67_2.png" src="_images/workshop notebook_67_2.png" />
</div>
</div>
</div>
<div class="section" id="cleanup">
<h2>Cleanup<a class="headerlink" href="#cleanup" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lets clear up some memory before proceeding to the next section!</span>
<span class="k">del</span> <span class="n">result</span>
<span class="k">del</span> <span class="n">ifos</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="analysis-of-gw150914">
<h1>Analysis of GW150914<a class="headerlink" href="#analysis-of-gw150914" title="Permalink to this headline">¶</a></h1>
<p>Lets analyse a real event!</p>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>First we import some functions so we dont need to put in the full path</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">bilby</span>
<span class="kn">from</span> <span class="nn">bilby</span> <span class="kn">import</span> <span class="n">run_sampler</span>
<span class="kn">from</span> <span class="nn">bilby.core.prior</span> <span class="kn">import</span> <span class="n">Constraint</span><span class="p">,</span> <span class="n">Uniform</span>
<span class="kn">from</span> <span class="nn">bilby.gw.conversion</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">convert_to_lal_binary_black_hole_parameters</span><span class="p">,</span>
    <span class="n">generate_all_bbh_parameters</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">bilby.gw.detector.networks</span> <span class="kn">import</span> <span class="n">InterferometerList</span>
<span class="kn">from</span> <span class="nn">bilby.gw.detector.psd</span> <span class="kn">import</span> <span class="n">PowerSpectralDensity</span>
<span class="kn">from</span> <span class="nn">bilby.gw.likelihood</span> <span class="kn">import</span> <span class="n">GravitationalWaveTransient</span>
<span class="kn">from</span> <span class="nn">bilby.gw.prior</span> <span class="kn">import</span> <span class="n">BBHPriorDict</span>
<span class="kn">from</span> <span class="nn">bilby.gw.result</span> <span class="kn">import</span> <span class="n">CBCResult</span>
<span class="kn">from</span> <span class="nn">bilby.gw.source</span> <span class="kn">import</span> <span class="n">lal_binary_black_hole</span>
<span class="kn">from</span> <span class="nn">bilby.gw.utils</span> <span class="kn">import</span> <span class="n">get_event_time</span>
<span class="kn">from</span> <span class="nn">bilby.gw.waveform_generator</span> <span class="kn">import</span> <span class="n">WaveformGenerator</span>
<span class="kn">from</span> <span class="nn">gwpy.plot</span> <span class="kn">import</span> <span class="n">Plot</span> <span class="k">as</span> <span class="n">GWpyPlot</span>
<span class="kn">from</span> <span class="nn">gwpy.timeseries</span> <span class="kn">import</span> <span class="n">TimeSeries</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span> 
<span class="n">bilby_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;bilby&quot;</span><span class="p">)</span>
<span class="n">bilby_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="downloading-ifo-data">
<h2>Downloading IFO data<a class="headerlink" href="#downloading-ifo-data" title="Permalink to this headline">¶</a></h2>
<p>Now we download the raw data and make some plots</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interferometers</span> <span class="o">=</span> <span class="n">InterferometerList</span><span class="p">([</span><span class="s2">&quot;H1&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">])</span>
<span class="n">trigger_time</span> <span class="o">=</span> <span class="n">get_event_time</span><span class="p">(</span><span class="s2">&quot;GW150914&quot;</span><span class="p">)</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">trigger_time</span> <span class="o">-</span> <span class="mi">3</span>
<span class="n">duration</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">duration</span>
<span class="n">roll_off</span> <span class="o">=</span> <span class="mf">0.2</span>
    


<span class="c1"># Get raw data</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">interferometers</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Getting </span><span class="si">{</span><span class="n">ifo</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> analysis data segment (takes ~ 30s)&quot;</span>
    <span class="p">)</span>
    <span class="n">analysis_data</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">fetch_open_data</span><span class="p">(</span>
        <span class="n">ifo</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span>
    <span class="p">)</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">strain_data</span><span class="o">.</span><span class="n">roll_off</span> <span class="o">=</span> <span class="n">roll_off</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">strain_data</span><span class="o">.</span><span class="n">set_from_gwpy_timeseries</span><span class="p">(</span><span class="n">analysis_data</span><span class="p">)</span>
    <span class="n">raw_data</span><span class="p">[</span><span class="n">ifo</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Getting H1 analysis data segment (takes ~ 30s)
Getting L1 analysis data segment (takes ~ 30s)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot raw data:</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">GWpyPlot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;auto-gps&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ifo_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ifo_name</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="mf">1126259462.427</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1126259462</span><span class="p">,</span> <span class="mf">1126259462.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Strain noise&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_74_0.png" src="_images/workshop notebook_74_0.png" />
</div>
</div>
<p>Woah. That looks terrible. Where is the nobel-prize winning poster-child signal?</p>
<p>We may need to clean up the data a bit to actually ‘see’ the signal. Lets get the data for the PSD and take a look at the noise once again</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># downloading data</span>
<span class="n">psd_start_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">duration</span>
<span class="n">psd_duration</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">psd_end_time</span> <span class="o">=</span> <span class="n">psd_start_time</span> <span class="o">+</span> <span class="n">psd_duration</span>
<span class="n">psd_tukey_alpha</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">roll_off</span> <span class="o">/</span> <span class="n">duration</span>
<span class="n">overlap</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">2</span>

<span class="k">for</span> <span class="n">interferometer</span> <span class="ow">in</span> <span class="n">interferometers</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Getting </span><span class="si">{</span><span class="n">interferometer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> PSD data segment (takes ~ 1min)&quot;</span>
    <span class="p">)</span>
    <span class="n">psd_data</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">fetch_open_data</span><span class="p">(</span>
        <span class="n">interferometer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">psd_start_time</span><span class="p">,</span> <span class="n">psd_end_time</span>
    <span class="p">)</span>
    <span class="n">psd</span> <span class="o">=</span> <span class="n">psd_data</span><span class="o">.</span><span class="n">psd</span><span class="p">(</span>
        <span class="n">fftlength</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;tukey&quot;</span><span class="p">,</span> <span class="n">psd_tukey_alpha</span><span class="p">),</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;median&quot;</span>
    <span class="p">)</span>
    <span class="n">interferometer</span><span class="o">.</span><span class="n">power_spectral_density</span> <span class="o">=</span> <span class="n">PowerSpectralDensity</span><span class="p">(</span>
        <span class="n">frequency_array</span><span class="o">=</span><span class="n">psd</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">psd_array</span><span class="o">=</span><span class="n">psd</span><span class="o">.</span><span class="n">value</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Getting H1 PSD data segment (takes ~ 1min)
Getting L1 PSD data segment (takes ~ 1min)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plotting</span>
<span class="k">for</span> <span class="n">interferometer</span> <span class="ow">in</span> <span class="n">interferometers</span><span class="p">:</span>
    <span class="n">analysis_data</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">frequency_domain_strain</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">frequency_array</span><span class="p">,</span> <span class="n">analysis_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Analysis Data&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">frequency_array</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">amplitude_spectral_density_array</span><span class="p">),</span>
               <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ASD (estimated noise)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">interferometer</span><span class="o">.</span><span class="n">minimum_frequency</span><span class="p">,</span> <span class="n">interferometer</span><span class="o">.</span><span class="n">maximum_frequency</span><span class="p">)</span>
    <span class="n">ymin_max</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">analysis_data</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">analysis_data</span><span class="p">)]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span> <span class="o">*</span><span class="n">ymin_max</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">ymin_max</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency [Hz]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Strain [strain/$\sqrt{\rm Hz}$]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">interferometer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> data&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">*</span><span class="n">ymin_max</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_77_0.png" src="_images/workshop notebook_77_0.png" />
<img alt="_images/workshop notebook_77_1.png" src="_images/workshop notebook_77_1.png" />
</div>
</div>
<p>Lets <code class="docutils literal notranslate"><span class="pre">notch</span></code> out the 60 and 120 Hz <code class="docutils literal notranslate"><span class="pre">violin</span></code> modes (black vertical lines), and only keep data within the 50-250Hz range (marked in green) from the raw data and re-plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">GWpyPlot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;auto-gps&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ifo_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">bandpass</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span><span class="o">.</span><span class="n">notch</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">notch</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ifo_name</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="mf">1126259462.427</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1126259462</span><span class="p">,</span> <span class="mf">1126259462.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1e-21</span><span class="p">,</span> <span class="mf">1e-21</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Strain noise&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_79_0.png" src="_images/workshop notebook_79_0.png" />
</div>
</div>
<p>Noiceee… Lets plot the signals in the frequency domain:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span> <span class="o">=</span> <span class="n">trigger_time</span>

<span class="k">for</span> <span class="n">ifo_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">qtrans</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">q_transform</span><span class="p">(</span>
        <span class="n">frange</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">500</span><span class="p">),</span> <span class="n">fres</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">outseg</span><span class="o">=</span><span class="p">(</span><span class="n">tc</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">tc</span><span class="o">+</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="n">qtrans</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">150</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ifo_name</span><span class="si">}</span><span class="s1"> Q-transform&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="n">trigger_time</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Normalised energy&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_81_0.png" src="_images/workshop notebook_81_0.png" />
<img alt="_images/workshop notebook_81_1.png" src="_images/workshop notebook_81_1.png" />
</div>
</div>
</div>
<div class="section" id="getting-priors">
<h2>Getting priors<a class="headerlink" href="#getting-priors" title="Permalink to this headline">¶</a></h2>
<p>Now lets write down our priors for this event’s analysis. Note that again we set several delta functions and restrict the search space to speed up analysis for the sake of this tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># setup the prior</span>
<span class="kn">from</span> <span class="nn">bilby.core.prior</span> <span class="kn">import</span> <span class="n">Uniform</span><span class="p">,</span> <span class="n">PowerLaw</span><span class="p">,</span> <span class="n">Sine</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">,</span> <span class="n">Cosine</span>
<span class="kn">from</span> <span class="nn">corner</span> <span class="kn">import</span> <span class="n">corner</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># typically we would use a priors with wide bounds:</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">trigger_time</span>
<span class="n">priors</span> <span class="o">=</span> <span class="n">BBHPriorDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">mass_ratio</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mass_ratio&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">chirp_mass</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;chirp_mass&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">31</span><span class="p">),</span>
    <span class="n">mass_1</span><span class="o">=</span><span class="n">Constraint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mass_1&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">80</span><span class="p">),</span>
    <span class="n">mass_2</span><span class="o">=</span><span class="n">Constraint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mass_2&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">80</span><span class="p">),</span>
    <span class="n">a_1</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;a_1&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mf">0.99</span><span class="p">),</span>
    <span class="n">a_2</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;a_2&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mf">0.99</span><span class="p">),</span>
    <span class="n">tilt_1</span><span class="o">=</span><span class="n">Sine</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tilt_1&#39;</span><span class="p">),</span>
    <span class="n">tilt_2</span><span class="o">=</span><span class="n">Sine</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tilt_2&#39;</span><span class="p">),</span>
    <span class="n">phi_12</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;phi_12&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;periodic&#39;</span><span class="p">),</span>
    <span class="n">phi_jl</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;phi_jl&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;periodic&#39;</span><span class="p">),</span>
    <span class="n">luminosity_distance</span><span class="o">=</span><span class="n">PowerLaw</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;luminosity_distance&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">2000</span><span class="p">),</span>
    <span class="n">dec</span><span class="o">=</span><span class="n">Cosine</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dec&#39;</span><span class="p">),</span>
    <span class="n">ra</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;periodic&#39;</span><span class="p">),</span>
    <span class="n">theta_jn</span><span class="o">=</span><span class="n">Sine</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;theta_jn&#39;</span><span class="p">),</span>
    <span class="n">psi</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;psi&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;periodic&#39;</span><span class="p">),</span>
    <span class="n">phase</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;phase&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;periodic&#39;</span><span class="p">),</span>
    <span class="n">geocent_time</span><span class="o">=</span><span class="n">Uniform</span><span class="p">(</span><span class="n">minimum</span><span class="o">=</span><span class="n">tc</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="n">tc</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">latex_label</span><span class="o">=</span><span class="s2">&quot;$t_c$&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;$s$&quot;</span><span class="p">)</span>
<span class="p">))</span>

<span class="c1"># HACK: for this example (to make analysis faster) we will use a prior with tighter bounds</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;luminosity_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">419.18</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;mass_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mass_1&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;mass_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mass_2&#39;</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.269</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.223</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;geocent_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tc</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;theta_jn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.921</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;phi_jl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.968</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;psi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.659</span>
<span class="c1"># dont do this in a real run </span>

<span class="n">prior_samples</span> <span class="o">=</span> <span class="n">priors</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">prior_samples_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">prior_samples</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plots of some priors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;chirp_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;a_1&#39;</span><span class="p">,</span> <span class="s1">&#39;a_2&#39;</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="p">(</span>
    <span class="n">prior_samples_df</span><span class="p">[</span><span class="n">parameters</span><span class="p">],</span> <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
    <span class="n">plot_contours</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:gray&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_85_0.png" src="_images/workshop notebook_85_0.png" />
</div>
</div>
<p>Lets convert some parameters and see what the prior-distributions we get</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bilby.gw.conversion</span> <span class="kn">import</span> <span class="n">generate_mass_parameters</span>

<span class="n">prior_samples</span> <span class="o">=</span> <span class="n">generate_mass_parameters</span><span class="p">(</span><span class="n">prior_samples</span><span class="p">)</span>
<span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;cos_tilt_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;tilt_1&#39;</span><span class="p">])</span>
<span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;cos_tilt_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;tilt_2&#39;</span><span class="p">])</span>
<span class="n">s1z</span> <span class="o">=</span> <span class="n">prior_samples</span><span class="p">[</span><span class="s2">&quot;a_1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;cos_tilt_1&#39;</span><span class="p">]</span>
<span class="n">s2z</span> <span class="o">=</span> <span class="n">prior_samples</span><span class="p">[</span><span class="s2">&quot;a_2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;cos_tilt_2&#39;</span><span class="p">]</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;mass_ratio&#39;</span><span class="p">]</span>
<span class="n">prior_samples</span><span class="p">[</span><span class="s1">&#39;chi_eff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">s1z</span> <span class="o">+</span> <span class="n">s2z</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
<span class="n">prior_samples_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">prior_samples</span><span class="p">)</span>
<span class="n">prior_samples_df</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mass_1&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_2&#39;</span><span class="p">,</span> <span class="s1">&#39;chi_eff&#39;</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="p">(</span><span class="n">prior_samples_df</span><span class="p">[</span><span class="n">parameters</span><span class="p">],</span> <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_contours</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:gray&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_87_0.png" src="_images/workshop notebook_87_0.png" />
</div>
</div>
</div>
<div class="section" id="inference-step">
<h2>Inference step<a class="headerlink" href="#inference-step" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waveform_generator</span> <span class="o">=</span> <span class="n">WaveformGenerator</span><span class="p">(</span>
    <span class="n">duration</span><span class="o">=</span><span class="n">interferometers</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
    <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">interferometers</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">,</span>
    <span class="n">frequency_domain_source_model</span><span class="o">=</span><span class="n">lal_binary_black_hole</span><span class="p">,</span>
    <span class="n">parameter_conversion</span><span class="o">=</span><span class="n">convert_to_lal_binary_black_hole_parameters</span><span class="p">,</span>
    <span class="n">waveform_arguments</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">waveform_approximant</span><span class="o">=</span><span class="s2">&quot;IMRPhenomPv2&quot;</span><span class="p">,</span>
        <span class="n">reference_frequency</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">likelihood</span> <span class="o">=</span> <span class="n">GravitationalWaveTransient</span><span class="p">(</span>
    <span class="n">interferometers</span><span class="o">=</span><span class="n">interferometers</span><span class="p">,</span> <span class="n">waveform_generator</span><span class="o">=</span><span class="n">waveform_generator</span><span class="p">,</span>
    <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span> <span class="n">time_marginalization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">distance_marginalization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">phase_marginalization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">jitter_time</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>


<span class="k">if</span> <span class="n">RE_RUN_SLOW_CELLS</span><span class="p">:</span>
    <span class="n">bilby_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">run_sampler</span><span class="p">(</span>
        <span class="n">likelihood</span><span class="o">=</span><span class="n">likelihood</span><span class="p">,</span> <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GW150914&quot;</span><span class="p">,</span>
        <span class="n">nlive</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">walks</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="c1"># HACK: use defaults nlive/walks (much more aggressive)</span>
        <span class="n">conversion_function</span><span class="o">=</span><span class="n">generate_all_bbh_parameters</span><span class="p">,</span>
        <span class="n">result_class</span><span class="o">=</span><span class="n">CBCResult</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping sampling...&quot;</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s2">/GW150914_result.json&quot;</span>
    <span class="n">download</span><span class="p">(</span><span class="n">GW150914_URL</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">CBCResult</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded result!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Skipping sampling...
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "a702199d740d42869b19b3dfe13b0d92", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loaded result!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mass_ratio&quot;</span><span class="p">,</span> <span class="s2">&quot;chi_eff&quot;</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_90_0.png" src="_images/workshop notebook_90_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mass_1&quot;</span><span class="p">,</span> <span class="s2">&quot;mass_2&quot;</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_91_0.png" src="_images/workshop notebook_91_0.png" />
</div>
</div>
<p>NOTE: To get some proper results, we’d have to run with more robust sampler settings and wider priors.</p>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="accessing-gwtc-parameter-estimation-results">
<h1>Accessing GWTC parameter estimation results<a class="headerlink" href="#accessing-gwtc-parameter-estimation-results" title="Permalink to this headline">¶</a></h1>
<p>The GWTC data and parameter estimation results are all online (eg https://zenodo.org/record/5546663).
Lets download one result and make some plots:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">OUTDIR</span><span class="o">=</span><span class="s2">&quot;outdir/&quot;</span>
<span class="n">GW200308_fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s2">/GW200308_result.h5&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">GW200308_URL</span><span class="p">,</span> <span class="n">GW200308_fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "345395d63abf402fa244feab1e112dc2", "version_major": 2, "version_minor": 0}
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>
<span class="n">GW200308_result</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">GW200308_fn</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GW200308 samples loaded!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GW200308 samples loaded!
</pre></div>
</div>
</div>
</div>
<p>Lets look at what is stored:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">GW200308_result</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">GW200308_result</span><span class="p">[</span><span class="s1">&#39;C01:IMRPhenomXPHM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;C01:IMRPhenomXPHM&#39;, &#39;C01:Mixed&#39;, &#39;C01:SEOBNRv4PHM&#39;, &#39;history&#39;, &#39;version&#39;]
[&#39;approximant&#39;, &#39;calibration_envelope&#39;, &#39;config_file&#39;, &#39;description&#39;, &#39;injection_data&#39;, &#39;meta_data&#39;, &#39;posterior_samples&#39;, &#39;priors&#39;, &#39;psds&#39;, &#39;skymap&#39;, &#39;version&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameters stored:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">GW200308_result</span><span class="p">[</span><span class="s1">&#39;C01:IMRPhenomXPHM&#39;</span><span class="p">][</span><span class="s1">&#39;posterior_samples&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Parameters stored:
  luminosity_distance
  geocent_time
  recalib_H1_frequency_0
  recalib_H1_frequency_1
  recalib_H1_frequency_2
  recalib_H1_frequency_3
  recalib_H1_frequency_4
  recalib_H1_frequency_5
  recalib_H1_frequency_6
  recalib_H1_frequency_7
  recalib_H1_frequency_8
  recalib_H1_frequency_9
  recalib_L1_frequency_0
  recalib_L1_frequency_1
  recalib_L1_frequency_2
  recalib_L1_frequency_3
  recalib_L1_frequency_4
  recalib_L1_frequency_5
  recalib_L1_frequency_6
  recalib_L1_frequency_7
  recalib_L1_frequency_8
  recalib_L1_frequency_9
  recalib_V1_frequency_0
  recalib_V1_frequency_1
  recalib_V1_frequency_2
  recalib_V1_frequency_3
  recalib_V1_frequency_4
  recalib_V1_frequency_5
  recalib_V1_frequency_6
  recalib_V1_frequency_7
  recalib_V1_frequency_8
  recalib_V1_frequency_9
  chirp_mass
  mass_ratio
  a_1
  a_2
  tilt_1
  tilt_2
  phi_12
  phi_jl
  theta_jn
  psi
  phase
  azimuth
  zenith
  recalib_H1_amplitude_0
  recalib_H1_amplitude_1
  recalib_H1_amplitude_2
  recalib_H1_amplitude_3
  recalib_H1_amplitude_4
  recalib_H1_amplitude_5
  recalib_H1_amplitude_6
  recalib_H1_amplitude_7
  recalib_H1_amplitude_8
  recalib_H1_amplitude_9
  recalib_H1_phase_0
  recalib_H1_phase_1
  recalib_H1_phase_2
  recalib_H1_phase_3
  recalib_H1_phase_4
  recalib_H1_phase_5
  recalib_H1_phase_6
  recalib_H1_phase_7
  recalib_H1_phase_8
  recalib_H1_phase_9
  recalib_L1_amplitude_0
  recalib_L1_amplitude_1
  recalib_L1_amplitude_2
  recalib_L1_amplitude_3
  recalib_L1_amplitude_4
  recalib_L1_amplitude_5
  recalib_L1_amplitude_6
  recalib_L1_amplitude_7
  recalib_L1_amplitude_8
  recalib_L1_amplitude_9
  recalib_L1_phase_0
  recalib_L1_phase_1
  recalib_L1_phase_2
  recalib_L1_phase_3
  recalib_L1_phase_4
  recalib_L1_phase_5
  recalib_L1_phase_6
  recalib_L1_phase_7
  recalib_L1_phase_8
  recalib_L1_phase_9
  recalib_V1_amplitude_0
  recalib_V1_amplitude_1
  recalib_V1_amplitude_2
  recalib_V1_amplitude_3
  recalib_V1_amplitude_4
  recalib_V1_amplitude_5
  recalib_V1_amplitude_6
  recalib_V1_amplitude_7
  recalib_V1_amplitude_8
  recalib_V1_amplitude_9
  recalib_V1_phase_0
  recalib_V1_phase_1
  recalib_V1_phase_2
  recalib_V1_phase_3
  recalib_V1_phase_4
  recalib_V1_phase_5
  recalib_V1_phase_6
  recalib_V1_phase_7
  recalib_V1_phase_8
  recalib_V1_phase_9
  time_jitter
  log_likelihood
  ra
  dec
  H1_matched_filter_snr
  H1_optimal_snr
  L1_matched_filter_snr
  L1_optimal_snr
  V1_matched_filter_snr
  V1_optimal_snr
  maximum_frequency
  pn_spin_order
  pn_tidal_order
  pn_phase_order
  pn_amplitude_order
  total_mass
  mass_1
  mass_2
  symmetric_mass_ratio
  phi_1
  phi_2
  chi_eff
  chi_1_in_plane
  chi_2_in_plane
  chi_p
  cos_tilt_1
  cos_tilt_2
  comoving_distance
  H1_matched_filter_abs_snr
  H1_matched_filter_snr_angle
  L1_matched_filter_abs_snr
  L1_matched_filter_snr_angle
  V1_matched_filter_abs_snr
  V1_matched_filter_snr_angle
  redshift
  inverted_mass_ratio
  mass_1_source
  mass_2_source
  total_mass_source
  chirp_mass_source
  iota
  spin_1x
  spin_1y
  spin_1z
  spin_2x
  spin_2y
  spin_2z
  tilt_1_infinity_only_prec_avg
  tilt_2_infinity_only_prec_avg
  chi_p_2spin
  spin_1z_infinity_only_prec_avg
  spin_2z_infinity_only_prec_avg
  chi_eff_infinity_only_prec_avg
  chi_p_infinity_only_prec_avg
  beta
  psi_J
  final_spin
  peak_luminosity
  final_mass
  cos_tilt_1_infinity_only_prec_avg
  cos_tilt_2_infinity_only_prec_avg
  final_mass_source
  radiated_energy
  H1_time
  L1_time
  V1_time
  network_optimal_snr
  network_matched_filter_snr
  cos_theta_jn
  viewing_angle
  cos_iota
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xphm_mc</span> <span class="o">=</span> <span class="n">GW200308_result</span><span class="p">[</span><span class="s1">&#39;C01:IMRPhenomXPHM&#39;</span><span class="p">][</span><span class="s1">&#39;posterior_samples&#39;</span><span class="p">][</span><span class="s1">&#39;chirp_mass&#39;</span><span class="p">][:]</span>
<span class="n">seob_mc</span> <span class="o">=</span> <span class="n">GW200308_result</span><span class="p">[</span><span class="s1">&#39;C01:SEOBNRv4PHM&#39;</span><span class="p">][</span><span class="s1">&#39;posterior_samples&#39;</span><span class="p">][</span><span class="s1">&#39;chirp_mass&#39;</span><span class="p">][:]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">xphm_mc</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;XPHM&#39;</span><span class="p">,</span>  <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">seob_mc</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>  <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SEOB&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Chirp-mass Msun&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/workshop notebook_99_0.png" src="_images/workshop notebook_99_0.png" />
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Avi Vajpeyi<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>